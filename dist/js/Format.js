(Format=function(t,e){this.editorUi=t,this.container=e}).prototype.labelIndex=0,Format.prototype.diagramIndex=0,Format.prototype.currentIndex=0,Format.prototype.showCloseButton=!0,Format.prototype.inactiveTabBackgroundColor="#f1f3f4",Format.prototype.roundableShapes=["label","rectangle","internalStorage","corner","parallelogram","swimlane","triangle","trapezoid","ext","step","tee","process","link","rhombus","offPageConnector","loopLimit","hexagon","manualInput","card","curlyBracket","singleArrow","callout","doubleArrow","flexArrow","umlLifeline"],Format.prototype.init=function(){var t=this.editorUi,e=t.editor,n=e.graph;this.update=mxUtils.bind(this,function(t,e){this.clearSelectionState(),this.refresh()}),n.getSelectionModel().addListener(mxEvent.CHANGE,this.update),n.addListener(mxEvent.EDITING_STARTED,this.update),n.addListener(mxEvent.EDITING_STOPPED,this.update),n.getModel().addListener(mxEvent.CHANGE,this.update),n.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){this.refresh()})),t.addListener("styleChanged",mxUtils.bind(this,function(t,e){this.refresh()})),e.addListener("autosaveChanged",mxUtils.bind(this,function(){this.refresh()})),this.refresh()},Format.prototype.clearSelectionState=function(){this.selectionState=null},Format.prototype.getSelectionState=function(){return null==this.selectionState&&(this.selectionState=this.createSelectionState()),this.selectionState},Format.prototype.createSelectionState=function(){for(var t=this.editorUi.editor.graph.getSelectionCells(),e=this.initSelectionState(),n=0;n<t.length;n++)this.updateSelectionStateForCell(e,t[n],t);return e},Format.prototype.initSelectionState=function(){return{vertices:[],edges:[],x:null,y:null,width:null,height:null,style:{},containsImage:!1,containsLabel:!1,fill:!0,glass:!0,rounded:!0,autoSize:!1,image:!0,shadow:!0,lineJumps:!0,resizable:!0,table:!1,cell:!1,row:!1,movable:!0,rotatable:!0,stroke:!0}},Format.prototype.updateSelectionStateForCell=function(t,e,n){var i,l=this.editorUi.editor.graph,s=(l.getModel().isVertex(e)?(t.resizable=t.resizable&&l.isCellResizable(e),t.rotatable=t.rotatable&&l.isCellRotatable(e),t.movable=t.movable&&l.isCellMovable(e)&&!l.isTableRow(e)&&!l.isTableCell(e),t.table=t.table||l.isTable(e),t.cell=t.cell||l.isTableCell(e),t.row=t.row||l.isTableRow(e),t.vertices.push(e),null!=(i=l.getCellGeometry(e))&&(0<i.width?null==t.width?t.width=i.width:t.width!=i.width&&(t.width=""):t.containsLabel=!0,0<i.height?null==t.height?t.height=i.height:t.height!=i.height&&(t.height=""):t.containsLabel=!0,i.relative&&null==i.offset||(a=(i.relative?i.offset:i).x,i=(i.relative?i.offset:i).y,null==t.x?t.x=a:t.x!=a&&(t.x=""),null==t.y?t.y=i:t.y!=i&&(t.y="")))):l.getModel().isEdge(e)&&(t.edges.push(e),t.resizable=!1,t.rotatable=!1,t.movable=!1),l.view.getState(e));if(null!=s){t.autoSize=t.autoSize||this.isAutoSizeState(s),t.glass=t.glass&&this.isGlassState(s),t.rounded=t.rounded&&this.isRoundedState(s),t.lineJumps=t.lineJumps&&this.isLineJumpState(s),t.image=t.image&&this.isImageState(s),t.shadow=t.shadow&&this.isShadowState(s),t.fill=t.fill&&this.isFillState(s),t.stroke=t.stroke&&this.isStrokeState(s);var o,a=mxUtils.getValue(s.style,mxConstants.STYLE_SHAPE,null);for(o in t.containsImage=t.containsImage||"image"==a,s.style){var r=s.style[o];null!=r&&(null==t.style[o]?t.style[o]=r:t.style[o]!=r&&(t.style[o]=""))}}},Format.prototype.isFillState=function(t){return!this.isSpecialColor(t.style[mxConstants.STYLE_FILLCOLOR])&&(t.view.graph.model.isVertex(t.cell)||"arrow"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)||"filledEdge"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)||"flexArrow"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null))},Format.prototype.isStrokeState=function(t){return!this.isSpecialColor(t.style[mxConstants.STYLE_STROKECOLOR])},Format.prototype.isSpecialColor=function(t){return 0<=mxUtils.indexOf([mxConstants.STYLE_STROKECOLOR,mxConstants.STYLE_FILLCOLOR,"inherit","swimlane","indicated"],t)},Format.prototype.isGlassState=function(t){t=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return"label"==t||"rectangle"==t||"internalStorage"==t||"ext"==t||"umlLifeline"==t||"swimlane"==t||"process"==t},Format.prototype.isRoundedState=function(t){return null!=t.shape?t.shape.isRoundable():0<=mxUtils.indexOf(this.roundableShapes,mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null))},Format.prototype.isLineJumpState=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return!mxUtils.getValue(t.style,mxConstants.STYLE_CURVED,!1)&&("connector"==e||"filledEdge"==e)},Format.prototype.isAutoSizeState=function(t){return"1"==mxUtils.getValue(t.style,mxConstants.STYLE_AUTOSIZE,null)},Format.prototype.isImageState=function(t){t=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return"label"==t||"image"==t},Format.prototype.isShadowState=function(t){return"image"!=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)},Format.prototype.clear=function(){if(this.container.innerHTML="",null!=this.panels)for(var t=0;t<this.panels.length;t++)this.panels[t].destroy();this.panels=[]},Format.prototype.refresh=function(){var t,l,e,s,o,a,n,i,r,d,u,m;"0px"!=this.container.style.width&&(this.clear(),t=this.editorUi,l=t.editor.graph,(e=document.createElement("div")).style.whiteSpace="nowrap",e.style.color="rgb(112, 112, 112)",e.style.textAlign="left",e.style.cursor="default",(u=document.createElement("div")).className="geFormatSection",u.style.textAlign="center",u.style.fontWeight="bold",u.style.paddingTop="8px",u.style.fontSize="13px",u.style.borderWidth="0px 0px 1px 1px",u.style.borderStyle="solid",u.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",u.style.height=mxClient.IS_QUIRKS?"34px":"25px",u.style.overflow="hidden",u.style.width="100%",this.container.appendChild(e),mxEvent.addListener(u,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),s=this.getSelectionState().containsLabel,a=o=null,n=mxUtils.bind(this,function(e,n,i){var t=mxUtils.bind(this,function(t){o!=e&&(s?this.labelIndex=i:l.isSelectionEmpty()?this.diagramIndex=i:this.currentIndex=i,null!=o&&(o.style.backgroundColor=this.inactiveTabBackgroundColor,o.style.borderBottomWidth="1px"),(o=e).style.backgroundColor="",o.style.borderBottomWidth="0px",a!=n&&(null!=a&&(a.style.display="none"),(a=n).style.display=""))});mxEvent.addListener(e,"click",t),mxEvent.addListener(e,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),i==(s?this.labelIndex:l.isSelectionEmpty()?this.diagramIndex:this.currentIndex)&&t()}),i=0,l.isSelectionEmpty()?(mxUtils.write(u,mxResources.get("diagram")),u.style.borderLeftWidth="0px",e.appendChild(u),d=e.cloneNode(!1),this.panels.push(new DiagramFormatPanel(this,t,d)),this.container.appendChild(d),null!=Editor.styles&&(d.style.display="none",u.style.width=this.showCloseButton?"106px":"50%",u.style.cursor="pointer",u.style.backgroundColor=this.inactiveTabBackgroundColor,(r=u.cloneNode(!1)).style.borderLeftWidth="1px",r.style.borderRightWidth="1px",r.style.backgroundColor=this.inactiveTabBackgroundColor,n(u,d,i++),(m=e.cloneNode(!1)).style.display="none",mxUtils.write(r,mxResources.get("style")),e.appendChild(r),this.panels.push(new DiagramStylePanel(this,t,m)),this.container.appendChild(m),n(r,m,i++)),this.showCloseButton&&((r=u.cloneNode(!1)).style.borderLeftWidth="1px",r.style.borderRightWidth="1px",r.style.borderBottomWidth="1px",r.style.backgroundColor=this.inactiveTabBackgroundColor,r.style.position="absolute",r.style.right="0px",r.style.top="0px",r.style.width="25px",(d=document.createElement("img")).setAttribute("border","0"),d.setAttribute("src",Dialog.prototype.closeImage),d.setAttribute("title",mxResources.get("hide")),d.style.position="absolute",d.style.display="block",d.style.right="0px",d.style.top="8px",d.style.cursor="pointer",d.style.marginTop="1px",d.style.marginRight="6px",d.style.border="1px solid transparent",d.style.padding="1px",d.style.opacity=.5,r.appendChild(d),mxEvent.addListener(d,"click",function(){t.actions.get("formatPanel").funct()}),e.appendChild(r))):l.isEditing()?(mxUtils.write(u,mxResources.get("text")),e.appendChild(u),this.panels.push(new TextFormatPanel(this,t,e))):(u.style.backgroundColor=this.inactiveTabBackgroundColor,u.style.borderLeftWidth="1px",u.style.cursor="pointer",u.style.width=s?"50%":"33.3%",d=(r=u.cloneNode(!1)).cloneNode(!1),r.style.backgroundColor=this.inactiveTabBackgroundColor,d.style.backgroundColor=this.inactiveTabBackgroundColor,s?r.style.borderLeftWidth="0px":(u.style.borderLeftWidth="0px",mxUtils.write(u,mxResources.get("style")),e.appendChild(u),(m=e.cloneNode(!1)).style.display="none",this.panels.push(new StyleFormatPanel(this,t,m)),this.container.appendChild(m),n(u,m,i++)),mxUtils.write(r,mxResources.get("text")),e.appendChild(r),(u=e.cloneNode(!1)).style.display="none",this.panels.push(new TextFormatPanel(this,t,u)),this.container.appendChild(u),mxUtils.write(d,mxResources.get("arrange")),e.appendChild(d),(m=e.cloneNode(!1)).style.display="none",this.panels.push(new ArrangePanel(this,t,m)),this.container.appendChild(m),n(r,u,i++),n(d,m,i++)))},(BaseFormatPanel=function(t,e,n){this.format=t,this.editorUi=e,this.container=n,this.listeners=[]}).prototype.buttonBackgroundColor="white",BaseFormatPanel.prototype.getSelectionState=function(){for(var t=this.editorUi.editor.graph,e=t.getSelectionCells(),n=null,i=0;i<e.length;i++){var l=t.view.getState(e[i]);if(null!=l){l=mxUtils.getValue(l.style,mxConstants.STYLE_SHAPE,null);if(null!=l)if(null==n)n=l;else if(n!=l)return null}}return n},BaseFormatPanel.prototype.installInputHandler=function(l,s,o,a,r,d,u,m){d=null!=d?d:"",m=null!=m&&m;var c=this.editorUi,p=c.editor.graph,g=(a=null!=a?a:1,r=null!=r?r:999,null),h=!1,t=mxUtils.bind(this,function(t){var e=(m?parseFloat:parseInt)(l.value);if(isNaN(e)||s!=mxConstants.STYLE_ROTATION||(e=mxUtils.mod(Math.round(100*e),36e3)/100),e=Math.min(r,Math.max(a,isNaN(e)?o:e)),p.cellEditor.isContentEditing()&&u)h||(h=!0,null!=g&&(p.cellEditor.restoreSelection(g),g=null),u(e),l.value=e+d,h=!1);else if(e!=mxUtils.getValue(this.format.getSelectionState().style,s,o)){p.isEditing()&&p.stopEditing(!0),p.getModel().beginUpdate();try{var n=p.getSelectionCells();p.setCellStyles(s,e,n),s==mxConstants.STYLE_FONTSIZE&&p.updateLabelElements(p.getSelectionCells(),function(t){t.style.fontSize=e+"px",t.removeAttribute("size")});for(var i=0;i<n.length;i++)0==p.model.getChildCount(n[i])&&p.autoSizeCell(n[i],!1);c.fireEvent(new mxEventObject("styleChanged","keys",[s],"values",[e],"cells",n))}finally{p.getModel().endUpdate()}}l.value=e+d,mxEvent.consume(t)});return u&&p.cellEditor.isContentEditing()&&(mxEvent.addListener(l,"mousedown",function(){document.activeElement==p.cellEditor.textarea&&(g=p.cellEditor.saveSelection())}),mxEvent.addListener(l,"touchstart",function(){document.activeElement==p.cellEditor.textarea&&(g=p.cellEditor.saveSelection())})),mxEvent.addListener(l,"change",t),mxEvent.addListener(l,"blur",t),t},BaseFormatPanel.prototype.createPanel=function(){var t=document.createElement("div");return t.className="geFormatSection",t.style.padding="12px 0px 12px 18px",t},BaseFormatPanel.prototype.createTitle=function(t){var e=document.createElement("div");return e.style.padding="0px 0px 6px 0px",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.width="200px",e.style.fontWeight="bold",mxUtils.write(e,t),e},BaseFormatPanel.prototype.createStepper=function(n,i,l,t,e,s,o){l=null!=l?l:1,t=null!=t?t:8,mxClient.IS_QUIRKS?t-=2:(mxClient.IS_MT||8<=document.documentMode)&&(t+=1);var a,r=document.createElement("div"),d=(mxUtils.setPrefixedStyle(r.style,"borderRadius","3px"),r.style.border="1px solid rgb(192, 192, 192)",r.style.position="absolute",document.createElement("div")),u=(d.style.borderBottom="1px solid rgb(192, 192, 192)",d.style.position="relative",d.style.height=t+"px",d.style.width="10px",d.className="geBtnUp",r.appendChild(d),d.cloneNode(!1));return u.style.border="none",u.style.height=t+"px",u.className="geBtnDown",r.appendChild(u),mxEvent.addListener(u,"click",function(t){""==n.value&&(n.value=s||"2");var e=(o?parseFloat:parseInt)(n.value);isNaN(e)||(n.value=e-l,null!=i&&i(t)),mxEvent.consume(t)}),mxEvent.addListener(d,"click",function(t){""==n.value&&(n.value=s||"0");var e=(o?parseFloat:parseInt)(n.value);isNaN(e)||(n.value=e+l,null!=i&&i(t)),mxEvent.consume(t)}),e&&(a=null,mxEvent.addGestureListeners(r,function(t){!mxClient.IS_QUIRKS&&8!=document.documentMode||(a=document.selection.createRange()),mxEvent.consume(t)},null,function(t){if(null!=a){try{a.select()}catch(t){}a=null,mxEvent.consume(t)}})),r},BaseFormatPanel.prototype.createOption=function(t,e,n,i,l){function s(t){d||(d=!0,t?(a.setAttribute("checked","checked"),a.defaultChecked=!0,a.checked=!0):(a.removeAttribute("checked"),a.defaultChecked=!1,a.checked=!1),u!=t&&(u=t,e()!=u&&n(u)),d=!1)}var o=document.createElement("div"),a=(o.style.padding="6px 0px 1px 0px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.width="200px",o.style.height=mxClient.IS_QUIRKS?"27px":"18px",document.createElement("input")),r=(a.setAttribute("type","checkbox"),a.style.margin="0px 6px 0px 0px",o.appendChild(a),document.createElement("span")),d=(mxUtils.write(r,t),o.appendChild(r),!1),u=e();return mxEvent.addListener(o,"click",function(t){"disabled"!=a.getAttribute("disabled")&&((t=mxEvent.getSource(t))!=o&&t!=r||(a.checked=!a.checked),s(a.checked))}),s(u),null!=i&&(i.install(s),this.listeners.push(i)),null!=l&&l(o),o},BaseFormatPanel.prototype.createCellOption=function(t,n,i,l,s,o,a,r){l=null!=l?"null"==l?null:l:"1",s=null!=s?"null"==s?null:s:"0";var d=this.editorUi,u=d.editor.graph;return this.createOption(t,function(){var t=u.view.getState(u.getSelectionCell());return null!=t?mxUtils.getValue(t.style,n,i)!=s:null},function(t){if(r&&u.stopEditing(),null!=a)a.funct();else{u.getModel().beginUpdate();try{var e=t?l:s;u.setCellStyles(n,e,u.getSelectionCells()),null!=o&&o(u.getSelectionCells(),e),d.fireEvent(new mxEventObject("styleChanged","keys",[n],"values",[e],"cells",u.getSelectionCells()))}finally{u.getModel().endUpdate()}}},{install:function(e){this.listener=function(){var t=u.view.getState(u.getSelectionCell());null!=t&&e(mxUtils.getValue(t.style,n,i)!=s)},u.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){u.getModel().removeListener(this.listener)}})},BaseFormatPanel.prototype.createColorOption=function(t,i,l,s,e,o,a){function n(t,e,n){c||(c=!0,t=/(^#?[a-zA-Z0-9]*$)/.test(t)?t:s,p.innerHTML='<div style="width:'+(mxClient.IS_QUIRKS?"30":"36")+"px;height:12px;margin:3px;border:1px solid black;background-color:"+mxUtils.htmlEntities(null!=t&&t!=mxConstants.NONE?t:s)+';"></div>',!mxClient.IS_QUIRKS&&8!=document.documentMode||(p.firstChild.style.margin="0px"),null!=t&&t!=mxConstants.NONE?(d.setAttribute("checked","checked"),d.defaultChecked=!0,d.checked=!0):(d.removeAttribute("checked"),d.defaultChecked=!1,d.checked=!1),p.style.display=d.checked||a?"":"none",null!=o&&o(t),e||(m=t,(n||a||i()!=m)&&l(m)),c=!1)}var r=document.createElement("div"),d=(r.style.padding="6px 0px 1px 0px",r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.width="200px",r.style.height=mxClient.IS_QUIRKS?"27px":"18px",document.createElement("input")),u=(d.setAttribute("type","checkbox"),d.style.margin="0px 6px 0px 0px",a||r.appendChild(d),document.createElement("span")),m=(mxUtils.write(u,t),r.appendChild(u),i()),c=!1,p=null;return(p=mxUtils.button("",mxUtils.bind(this,function(t){this.editorUi.pickColor(m,function(t){n(t,null,!0)}),mxEvent.consume(t)}))).style.position="absolute",p.style.marginTop="-4px",p.style.right=mxClient.IS_QUIRKS?"0px":"20px",p.style.height="22px",p.className="geColorBtn",p.style.display=d.checked||a?"":"none",r.appendChild(p),mxEvent.addListener(r,"click",function(t){t=mxEvent.getSource(t);t!=d&&"INPUT"==t.nodeName||(t!=d&&(d.checked=!d.checked),d.checked||null==m||m==mxConstants.NONE||s==mxConstants.NONE||(s=m),n(d.checked?s:mxConstants.NONE))}),n(m,!0),null!=e&&(e.install(n),this.listeners.push(e)),r},BaseFormatPanel.prototype.createCellColorOption=function(t,n,e,i,l){var s=this.editorUi,o=s.editor.graph;return this.createColorOption(t,function(){var t=o.view.getState(o.getSelectionCell());return null!=t?mxUtils.getValue(t.style,n,null):null},function(t){o.getModel().beginUpdate();try{o.setCellStyles(n,t,o.getSelectionCells()),null!=l&&l(t),s.fireEvent(new mxEventObject("styleChanged","keys",[n],"values",[t],"cells",o.getSelectionCells()))}finally{o.getModel().endUpdate()}},e||mxConstants.NONE,{install:function(e){this.listener=function(){var t=o.view.getState(o.getSelectionCell());null!=t&&e(mxUtils.getValue(t.style,n,null))},o.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){o.getModel().removeListener(this.listener)}},i)},BaseFormatPanel.prototype.addArrow=function(t,e){e=null!=e?e:10;var n=document.createElement("div"),i=(n.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",n.style.padding="6px",n.style.paddingRight="4px",10-e),i=(2==i?n.style.paddingTop="6px":0<i?n.style.paddingTop=6-i+"px":n.style.marginTop="-2px",n.style.height=e+"px",n.style.borderLeft="1px solid #a0a0a0",n.innerHTML='<img border="0" src="'+(mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHBJREFUeNpidHB2ZyAGsACxDRBPIKCuA6TwCBB/h2rABu4A8SYmKCcXiP/iUFgAxL9gCi8A8SwsirZCMQMTkmANEH9E4v+CmsaArvAdyNFI/FlQ92EoBIE+qCRIUz168DBgsU4OqhinQpgHMABAgAEALY4XLIsJ20oAAAAASUVORK5CYII=":IMAGE_PATH+"/dropdown.png")+'" style="margin-bottom:4px;">',mxUtils.setOpacity(n,70),t.getElementsByTagName("div")[0]);return null!=i&&(i.style.paddingRight="6px",i.style.marginLeft="4px",i.style.marginTop="-1px",i.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",mxUtils.setOpacity(i,60)),mxUtils.setOpacity(t,100),t.style.border="1px solid #a0a0a0",t.style.backgroundColor=this.buttonBackgroundColor,t.style.backgroundImage="none",t.style.width="auto",t.className+=" geColorBtn",mxUtils.setPrefixedStyle(t.style,"borderRadius","3px"),t.appendChild(n),i},BaseFormatPanel.prototype.addUnitInput=function(t,e,n,i,l,s,o,a,r){o=null!=o?o:0;var d=document.createElement("input"),i=(d.style.position="absolute",d.style.textAlign="right",d.style.marginTop="-2px",d.style.right=n+12+"px",d.style.width=i+"px",t.appendChild(d),this.createStepper(d,l,s,null,a,null,r));return i.style.marginTop=o-2+"px",i.style.right=n+"px",t.appendChild(i),d},BaseFormatPanel.prototype.createRelativeOption=function(t,i,e,l,n){e=null!=e?e:44;var s,o=this.editorUi.editor.graph,a=this.createPanel(),t=(a.style.paddingTop="10px",a.style.paddingBottom="10px",mxUtils.write(a,t),a.style.fontWeight="bold",mxUtils.bind(this,function(t){var e,n;null!=l?l(r):(e=parseInt(r.value),e=Math.min(100,Math.max(0,isNaN(e)?100:e)),null!=(n=o.view.getState(o.getSelectionCell()))&&e!=mxUtils.getValue(n.style,i,100)&&(o.setCellStyles(i,e=100==e?null:e,o.getSelectionCells()),this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",[i],"values",[e],"cells",o.getSelectionCells()))),r.value=(null!=e?e:"100")+" %"),mxEvent.consume(t)})),r=this.addUnitInput(a,"%",20,e,t,10,-15,null!=l);return null!=i&&(s=mxUtils.bind(this,function(t,e,n){!n&&r==document.activeElement||(n=this.format.getSelectionState(),n=parseInt(mxUtils.getValue(n.style,i,100)),r.value=isNaN(n)?"":n+" %")}),mxEvent.addListener(r,"keydown",function(t){13==t.keyCode?(o.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(s(null,null,!0),o.container.focus(),mxEvent.consume(t))}),o.getModel().addListener(mxEvent.CHANGE,s),this.listeners.push({destroy:function(){o.getModel().removeListener(s)}}),s()),mxEvent.addListener(r,"blur",t),mxEvent.addListener(r,"change",t),null!=n&&n(r),a},BaseFormatPanel.prototype.addLabel=function(t,e,n,i){i=null!=i?i:61;var l=document.createElement("div");mxUtils.write(l,e),l.style.position="absolute",l.style.right=n+"px",l.style.width=i+"px",l.style.marginTop="6px",l.style.textAlign="center",t.appendChild(l)},BaseFormatPanel.prototype.addKeyHandler=function(t,e){mxEvent.addListener(t,"keydown",mxUtils.bind(this,function(t){13==t.keyCode?(this.editorUi.editor.graph.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(null!=e&&e(null,null,!0),this.editorUi.editor.graph.container.focus(),mxEvent.consume(t))}))},BaseFormatPanel.prototype.styleButtons=function(t){for(var e=0;e<t.length;e++)mxUtils.setPrefixedStyle(t[e].style,"borderRadius","3px"),mxUtils.setOpacity(t[e],100),t[e].style.border="1px solid #a0a0a0",t[e].style.padding="4px",t[e].style.paddingTop="3px",t[e].style.paddingRight="1px",t[e].style.margin="1px",t[e].style.width="24px",t[e].style.height="20px",t[e].className+=" geColorBtn"},BaseFormatPanel.prototype.destroy=function(){if(null!=this.listeners){for(var t=0;t<this.listeners.length;t++)this.listeners[t].destroy();this.listeners=null}},ArrangePanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(ArrangePanel,BaseFormatPanel),ArrangePanel.prototype.init=function(){var t=this.editorUi.editor.graph,e=this.format.getSelectionState();this.container.appendChild(this.addLayerOps(this.createPanel())),this.addGeometry(this.container),this.addEdgeGeometry(this.container),e.containsLabel&&0!=e.edges.length||this.container.appendChild(this.addAngle(this.createPanel())),e.containsLabel||0!=e.edges.length||"rectangle"==e.style.shape||"label"==e.style.shape||this.container.appendChild(this.addFlip(this.createPanel())),1<e.vertices.length&&(this.container.appendChild(this.addAlign(this.createPanel())),this.container.appendChild(this.addDistribute(this.createPanel()))),(t.isTable(e.vertices[0])||t.isTableRow(e.vertices[0])||t.isTableCell(e.vertices[0]))&&this.container.appendChild(this.addTable(this.createPanel())),this.container.appendChild(this.addGroupOps(this.createPanel())),e.containsLabel&&((t=document.createElement("div")).style.width="100%",t.style.marginTop="0px",t.style.fontWeight="bold",t.style.padding="10px 0 0 18px",mxUtils.write(t,mxResources.get("style")),this.container.appendChild(t),new StyleFormatPanel(this.format,this.editorUi,this.container))},ArrangePanel.prototype.addTable=function(t){var e=this.editorUi,n=e.editor.graph,i=this.format.getSelectionState(),l=(t.style.paddingTop="6px",t.style.paddingBottom="10px",document.createElement("div")),l=(l.style.marginTop="2px",l.style.marginBottom="8px",l.style.fontWeight="bold",mxUtils.write(l,mxResources.get("table")),t.appendChild(l),document.createElement("div")),s=(l.style.position="relative",l.style.paddingLeft="0px",l.style.borderWidth="0px",l.className="geToolbarContainer",[e.toolbar.addButton("geSprite-insertcolumnbefore",mxResources.get("insertColumnBefore"),mxUtils.bind(this,function(){try{n.insertTableColumn(i.vertices[0],!0)}catch(t){e.handleError(t)}}),l),e.toolbar.addButton("geSprite-insertcolumnafter",mxResources.get("insertColumnAfter"),mxUtils.bind(this,function(){try{n.insertTableColumn(i.vertices[0],!1)}catch(t){e.handleError(t)}}),l),e.toolbar.addButton("geSprite-deletecolumn",mxResources.get("deleteColumn"),mxUtils.bind(this,function(){try{n.deleteTableColumn(i.vertices[0])}catch(t){e.handleError(t)}}),l),e.toolbar.addButton("geSprite-insertrowbefore",mxResources.get("insertRowBefore"),mxUtils.bind(this,function(){try{n.insertTableRow(i.vertices[0],!0)}catch(t){e.handleError(t)}}),l),e.toolbar.addButton("geSprite-insertrowafter",mxResources.get("insertRowAfter"),mxUtils.bind(this,function(){try{n.insertTableRow(i.vertices[0],!1)}catch(t){e.handleError(t)}}),l),e.toolbar.addButton("geSprite-deleterow",mxResources.get("deleteRow"),mxUtils.bind(this,function(){try{n.deleteTableRow(i.vertices[0])}catch(t){e.handleError(t)}}),l)]);return this.styleButtons(s),t.appendChild(l),s[2].style.marginRight="9px",t},ArrangePanel.prototype.addLayerOps=function(t){var e=this.editorUi,n=mxUtils.button(mxResources.get("toFront"),function(t){e.actions.get("toFront").funct()});return n.setAttribute("title",mxResources.get("toFront")+" ("+this.editorUi.actions.get("toFront").shortcut+")"),n.style.width="100px",n.style.marginRight="2px",t.appendChild(n),(n=mxUtils.button(mxResources.get("toBack"),function(t){e.actions.get("toBack").funct()})).setAttribute("title",mxResources.get("toBack")+" ("+this.editorUi.actions.get("toBack").shortcut+")"),n.style.width="100px",t.appendChild(n),t},ArrangePanel.prototype.addGroupOps=function(t){var e,n=this.editorUi,i=n.editor.graph,l=i.getSelectionCell(),s=this.format.getSelectionState(),o=0,a=null;return t.style.paddingTop="8px",t.style.paddingBottom="6px",1<i.getSelectionCount()?((a=mxUtils.button(mxResources.get("group"),function(t){n.actions.get("group").funct()})).setAttribute("title",mxResources.get("group")+" ("+this.editorUi.actions.get("group").shortcut+")"),a.style.width="202px",a.style.marginBottom="2px",t.appendChild(a),o++):!(1!=i.getSelectionCount()||i.getModel().isEdge(l)||i.isSwimlane(l)||i.isTable(l)||s.row||s.cell)&&0<i.getModel().getChildCount(l)&&((a=mxUtils.button(mxResources.get("ungroup"),function(t){n.actions.get("ungroup").funct()})).setAttribute("title",mxResources.get("ungroup")+" ("+this.editorUi.actions.get("ungroup").shortcut+")"),a.style.width="202px",a.style.marginBottom="2px",t.appendChild(a),o++),0<s.vertices.length&&(0<o&&(mxUtils.br(t),o=0),(a=mxUtils.button(mxResources.get("copySize"),function(t){n.actions.get("copySize").funct()})).setAttribute("title",mxResources.get("copySize")+" ("+this.editorUi.actions.get("copySize").shortcut+")"),a.style.width="202px",a.style.marginBottom="2px",t.appendChild(a),o++,null!=n.copiedSize&&((e=mxUtils.button(mxResources.get("pasteSize"),function(t){n.actions.get("pasteSize").funct()})).setAttribute("title",mxResources.get("pasteSize")+" ("+this.editorUi.actions.get("pasteSize").shortcut+")"),t.appendChild(e),o++,a.style.width="100px",a.style.marginBottom="2px",e.style.width="100px",e.style.marginBottom="2px")),1==i.getSelectionCount()&&i.getModel().isVertex(l)&&!s.row&&!s.cell&&i.getModel().isVertex(i.getModel().getParent(l))?(0<o&&mxUtils.br(t),(a=mxUtils.button(mxResources.get("removeFromGroup"),function(t){n.actions.get("removeFromGroup").funct()})).setAttribute("title",mxResources.get("removeFromGroup")),a.style.width="202px",a.style.marginBottom="2px",t.appendChild(a),o++):0<i.getSelectionCount()&&(0<o&&mxUtils.br(t),(a=mxUtils.button(mxResources.get("clearWaypoints"),mxUtils.bind(this,function(t){this.editorUi.actions.get("clearWaypoints").funct()}))).setAttribute("title",mxResources.get("clearWaypoints")+" ("+this.editorUi.actions.get("clearWaypoints").shortcut+")"),a.style.width="202px",a.style.marginBottom="2px",t.appendChild(a),o++),1==i.getSelectionCount()&&(0<o&&mxUtils.br(t),(a=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editData").funct()}))).setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),a.style.width="100px",a.style.marginBottom="2px",t.appendChild(a),o++,(a=mxUtils.button(mxResources.get("editLink"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editLink").funct()}))).setAttribute("title",mxResources.get("editLink")),a.style.width="100px",a.style.marginLeft="2px",a.style.marginBottom="2px",t.appendChild(a),o++),0==o&&(t.style.display="none"),t},ArrangePanel.prototype.addAlign=function(t){var e=this.editorUi.editor.graph,n=(t.style.paddingTop="6px",t.style.paddingBottom="12px",t.appendChild(this.createTitle(mxResources.get("align"))),document.createElement("div")),i=(n.style.position="relative",n.style.paddingLeft="0px",n.style.borderWidth="0px",n.className="geToolbarContainer",mxClient.IS_QUIRKS&&(t.style.height="60px"),this.editorUi.toolbar.addButton("geSprite-alignleft",mxResources.get("left"),function(){e.alignCells(mxConstants.ALIGN_LEFT)},n)),l=this.editorUi.toolbar.addButton("geSprite-aligncenter",mxResources.get("center"),function(){e.alignCells(mxConstants.ALIGN_CENTER)},n),s=this.editorUi.toolbar.addButton("geSprite-alignright",mxResources.get("right"),function(){e.alignCells(mxConstants.ALIGN_RIGHT)},n),o=this.editorUi.toolbar.addButton("geSprite-aligntop",mxResources.get("top"),function(){e.alignCells(mxConstants.ALIGN_TOP)},n),a=this.editorUi.toolbar.addButton("geSprite-alignmiddle",mxResources.get("middle"),function(){e.alignCells(mxConstants.ALIGN_MIDDLE)},n),r=this.editorUi.toolbar.addButton("geSprite-alignbottom",mxResources.get("bottom"),function(){e.alignCells(mxConstants.ALIGN_BOTTOM)},n);return this.styleButtons([i,l,s,o,a,r]),s.style.marginRight="6px",t.appendChild(n),t},ArrangePanel.prototype.addFlip=function(t){var e=this.editorUi.editor.graph,n=(t.style.paddingTop="6px",t.style.paddingBottom="10px",document.createElement("div")),n=(n.style.marginTop="2px",n.style.marginBottom="8px",n.style.fontWeight="bold",mxUtils.write(n,mxResources.get("flip")),t.appendChild(n),mxUtils.button(mxResources.get("horizontal"),function(t){e.toggleCellStyles(mxConstants.STYLE_FLIPH,!1)}));return n.setAttribute("title",mxResources.get("horizontal")),n.style.width="100px",n.style.marginRight="2px",t.appendChild(n),(n=mxUtils.button(mxResources.get("vertical"),function(t){e.toggleCellStyles(mxConstants.STYLE_FLIPV,!1)})).setAttribute("title",mxResources.get("vertical")),n.style.width="100px",t.appendChild(n),t},ArrangePanel.prototype.addDistribute=function(t){var e=this.editorUi.editor.graph,n=(t.style.paddingTop="6px",t.style.paddingBottom="12px",t.appendChild(this.createTitle(mxResources.get("distribute"))),mxUtils.button(mxResources.get("horizontal"),function(t){e.distributeCells(!0)}));return n.setAttribute("title",mxResources.get("horizontal")),n.style.width="100px",n.style.marginRight="2px",t.appendChild(n),(n=mxUtils.button(mxResources.get("vertical"),function(t){e.distributeCells(!1)})).setAttribute("title",mxResources.get("vertical")),n.style.width="100px",t.appendChild(n),t},ArrangePanel.prototype.addAngle=function(t){var e,n=this.editorUi,i=n.editor.graph,l=this.format.getSelectionState(),s=(t.style.paddingBottom="8px",document.createElement("div")),o=(s.style.position="absolute",s.style.width="70px",s.style.marginTop="0px",s.style.fontWeight="bold",null),a=null,r=null;return!l.rotatable||l.table||l.row||l.cell?t.style.paddingTop="8px":(mxUtils.write(s,mxResources.get("angle")),t.appendChild(s),o=this.addUnitInput(t,"°",20,44,function(){a.apply(this,arguments)}),mxUtils.br(t),t.style.paddingTop="10px"),l.containsLabel||(s=mxResources.get("reverse"),0<l.vertices.length&&0<l.edges.length?s=mxResources.get("turn")+" / "+s:0<l.vertices.length&&(s=mxResources.get("turn")),(r=mxUtils.button(s,function(t){n.actions.get("turn").funct(t)})).setAttribute("title",s+" ("+this.editorUi.actions.get("turn").shortcut+")"),r.style.width="202px",t.appendChild(r),null!=o&&(r.style.marginTop="8px")),null!=o&&(e=mxUtils.bind(this,function(t,e,n){!n&&document.activeElement==o||(l=this.format.getSelectionState(),n=parseFloat(mxUtils.getValue(l.style,mxConstants.STYLE_ROTATION,0)),o.value=isNaN(n)?"":n+"°")}),a=this.installInputHandler(o,mxConstants.STYLE_ROTATION,0,0,360,"°",null,!0),this.addKeyHandler(o,e),i.getModel().addListener(mxEvent.CHANGE,e),this.listeners.push({destroy:function(){i.getModel().removeListener(e)}}),e()),t},BaseFormatPanel.prototype.getUnit=function(){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return"pt";case mxConstants.INCHES:return'"';case mxConstants.MILLIMETERS:return"mm"}},BaseFormatPanel.prototype.inUnit=function(t){return this.editorUi.editor.graph.view.formatUnitText(t)},BaseFormatPanel.prototype.fromUnit=function(t){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return t;case mxConstants.INCHES:return t*mxConstants.PIXELS_PER_INCH;case mxConstants.MILLIMETERS:return t*mxConstants.PIXELS_PER_MM}},BaseFormatPanel.prototype.isFloatUnit=function(){return this.editorUi.editor.graph.view.unit!=mxConstants.POINTS},BaseFormatPanel.prototype.getUnitStep=function(){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return 1;case mxConstants.INCHES:return.1;case mxConstants.MILLIMETERS:return.5}},ArrangePanel.prototype.addGeometry=function(t){var e,n,i,l,s=this,o=this.editorUi,a=o.editor.graph,r=this.format.getSelectionState(),d=this.createPanel(),u=(d.style.paddingBottom="8px",document.createElement("div")),m=(u.style.position="absolute",u.style.width="50px",u.style.marginTop="0px",u.style.fontWeight="bold",mxUtils.write(u,mxResources.get("size")),d.appendChild(u),this.addUnitInput(d,this.getUnit(),84,44,function(){e.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit())),c=this.addUnitInput(d,this.getUnit(),20,44,function(){n.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),p=document.createElement("div"),g=(p.className="geSprite geSprite-fit",p.setAttribute("title",mxResources.get("autosize")+" ("+this.editorUi.actions.get("autosize").shortcut+")"),p.style.position="relative",p.style.cursor="pointer",p.style.marginTop="-3px",p.style.border="0px",p.style.left="42px",mxUtils.setOpacity(p,50),mxEvent.addListener(p,"mouseenter",function(){mxUtils.setOpacity(p,100)}),mxEvent.addListener(p,"mouseleave",function(){mxUtils.setOpacity(p,50)}),mxEvent.addListener(p,"click",function(){o.actions.get("autosize").funct()}),d.appendChild(p),r.row?(m.style.visibility="hidden",m.nextSibling.style.visibility="hidden"):this.addLabel(d,mxResources.get("width"),84),this.addLabel(d,mxResources.get("height"),20),mxUtils.br(d),document.createElement("div")),h=(g.style.paddingTop="8px",g.style.paddingRight="20px",g.style.whiteSpace="nowrap",g.style.textAlign="right",this.createCellOption(mxResources.get("constrainProportions"),mxConstants.STYLE_ASPECT,null,"fixed","null")),x=(h.style.width="100%",g.appendChild(h),r.cell||r.row?p.style.visibility="hidden":d.appendChild(g),h.getElementsByTagName("input")[0]),y=(this.addKeyHandler(m,void 0),this.addKeyHandler(c,void 0),e=this.addGeometryHandler(m,function(t,e,n){if(a.isTableCell(n))return a.setTableColumnWidth(n,e-t.width,!0),!0;0<t.width&&(e=Math.max(1,s.fromUnit(e)),x.checked&&(t.height=Math.round(t.height*e*100/t.width)/100),t.width=e)}),n=this.addGeometryHandler(c,function(t,e,n){if(a.isTableCell(n)&&(n=a.model.getParent(n)),a.isTableRow(n))return a.setTableRowHeight(n,e-t.height),!0;0<t.height&&(e=Math.max(1,s.fromUnit(e)),x.checked&&(t.width=Math.round(t.width*e*100/t.height)/100),t.height=e)}),(r.resizable||r.row||r.cell)&&t.appendChild(d),this.createPanel());y.style.paddingBottom="30px";(u=document.createElement("div")).style.position="absolute",u.style.width="70px",u.style.marginTop="0px",u.style.fontWeight="bold",mxUtils.write(u,mxResources.get("position")),y.appendChild(u);var S=this.addUnitInput(y,this.getUnit(),84,44,function(){i.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),C=this.addUnitInput(y,this.getUnit(),20,44,function(){l.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),E=(mxUtils.br(y),this.addLabel(y,mxResources.get("left"),84),this.addLabel(y,mxResources.get("top"),20),mxUtils.bind(this,function(t,e,n){(r=this.format.getSelectionState()).containsLabel||r.vertices.length!=a.getSelectionCount()||null==r.width||null==r.height?d.style.display="none":(d.style.display="",!n&&document.activeElement==m||(m.value=this.inUnit(r.width)+(""==r.width?"":" "+this.getUnit())),!n&&document.activeElement==c||(c.value=this.inUnit(r.height)+(""==r.height?"":" "+this.getUnit()))),r.vertices.length==a.getSelectionCount()&&null!=r.x&&null!=r.y?(y.style.display="",!n&&document.activeElement==S||(S.value=this.inUnit(r.x)+(""==r.x?"":" "+this.getUnit())),!n&&document.activeElement==C||(C.value=this.inUnit(r.y)+(""==r.y?"":" "+this.getUnit()))):y.style.display="none"}));this.addKeyHandler(S,E),this.addKeyHandler(C,E),a.getModel().addListener(mxEvent.CHANGE,E),this.listeners.push({destroy:function(){a.getModel().removeListener(E)}}),E(),i=this.addGeometryHandler(S,function(t,e){e=s.fromUnit(e),t.relative?t.offset.x=e:t.x=e}),l=this.addGeometryHandler(C,function(t,e){e=s.fromUnit(e),t.relative?t.offset.y=e:t.y=e}),r.movable&&t.appendChild(y)},ArrangePanel.prototype.addGeometryHandler=function(o,a){var r=this.editorUi.editor.graph,d=null,u=this;function t(t){if(""!=o.value){var e=parseFloat(o.value);if(isNaN(e))o.value=d+" "+u.getUnit();else if(e!=d){r.getModel().beginUpdate();try{for(var n,i,l=r.getSelectionCells(),s=0;s<l.length;s++)!r.getModel().isVertex(l[s])||null!=(i=r.getCellGeometry(l[s]))&&(i=i.clone(),a(i,e,l[s])||(null!=(n=r.view.getState(l[s]))&&r.isRecursiveVertexResize(n)&&r.resizeChildCells(l[s],i),r.getModel().setGeometry(l[s],i),r.constrainChildCells(l[s])))}finally{r.getModel().endUpdate()}d=e,o.value=e+" "+u.getUnit()}}mxEvent.consume(t)}return mxEvent.addListener(o,"blur",t),mxEvent.addListener(o,"change",t),mxEvent.addListener(o,"focus",function(){d=o.value}),t},ArrangePanel.prototype.addEdgeGeometryHandler=function(s,o){var a=this.editorUi.editor.graph,r=null;function t(t){if(""!=s.value){var e=parseFloat(s.value);if(isNaN(e))s.value=r+" pt";else if(e!=r){a.getModel().beginUpdate();try{for(var n,i=a.getSelectionCells(),l=0;l<i.length;l++)!a.getModel().isEdge(i[l])||null!=(n=a.getCellGeometry(i[l]))&&(n=n.clone(),o(n,e),a.getModel().setGeometry(i[l],n))}finally{a.getModel().endUpdate()}r=e,s.value=e+" pt"}}mxEvent.consume(t)}return mxEvent.addListener(s,"blur",t),mxEvent.addListener(s,"change",t),mxEvent.addListener(s,"focus",function(){r=s.value}),t},ArrangePanel.prototype.addEdgeGeometry=function(t){var e,n=this.editorUi,l=n.editor.graph,s=this.format.getSelectionState(),o=this.createPanel(),a=((i=document.createElement("div")).style.position="absolute",i.style.width="70px",i.style.marginTop="0px",i.style.fontWeight="bold",mxUtils.write(i,mxResources.get("width")),o.appendChild(i),this.addUnitInput(o,"pt",20,44,function(){e.apply(this,arguments)}));function e(t){var e=parseInt(a.value);(e=Math.min(999,Math.max(1,isNaN(e)?1:e)))!=mxUtils.getValue(s.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth)&&(l.setCellStyles("width",e,l.getSelectionCells()),n.fireEvent(new mxEventObject("styleChanged","keys",["width"],"values",[e],"cells",l.getSelectionCells()))),a.value=e+" pt",mxEvent.consume(t)}mxUtils.br(o),this.addKeyHandler(a,g),mxEvent.addListener(a,"blur",e),mxEvent.addListener(a,"change",e),t.appendChild(o);var r=this.createPanel();r.style.paddingBottom="30px";(i=document.createElement("div")).style.position="absolute",i.style.width="70px",i.style.marginTop="0px",i.style.fontWeight="bold",mxUtils.write(i,"Start"),r.appendChild(i);var d=this.addUnitInput(r,"pt",84,44,function(){h.apply(this,arguments)}),u=this.addUnitInput(r,"pt",20,44,function(){x.apply(this,arguments)}),m=(mxUtils.br(r),this.addLabel(r,mxResources.get("left"),84),this.addLabel(r,mxResources.get("top"),20),t.appendChild(r),this.addKeyHandler(d,g),this.addKeyHandler(u,g),this.createPanel());m.style.paddingBottom="30px";(i=document.createElement("div")).style.position="absolute",i.style.width="70px",i.style.marginTop="0px",i.style.fontWeight="bold",mxUtils.write(i,"End"),m.appendChild(i);var i,c=this.addUnitInput(m,"pt",84,44,function(){y.apply(this,arguments)}),p=this.addUnitInput(m,"pt",20,44,function(){S.apply(this,arguments)}),g=(mxUtils.br(m),this.addLabel(m,mxResources.get("left"),84),this.addLabel(m,mxResources.get("top"),20),t.appendChild(m),this.addKeyHandler(c,g),this.addKeyHandler(p,g),mxUtils.bind(this,function(t,e,n){s=this.format.getSelectionState();var i=l.getSelectionCell();"link"==s.style.shape||"flexArrow"==s.style.shape?(o.style.display="",!n&&document.activeElement==a||(n=mxUtils.getValue(s.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth),a.value=n+" pt")):o.style.display="none",1==l.getSelectionCount()&&l.model.isEdge(i)?(null!=(n=l.model.getGeometry(i)).sourcePoint&&null==l.model.getTerminal(i,!0)?(d.value=n.sourcePoint.x,u.value=n.sourcePoint.y):r.style.display="none",null!=n.targetPoint&&null==l.model.getTerminal(i,!1)?(c.value=n.targetPoint.x,p.value=n.targetPoint.y):m.style.display="none"):(r.style.display="none",m.style.display="none")})),h=this.addEdgeGeometryHandler(d,function(t,e){t.sourcePoint.x=e}),x=this.addEdgeGeometryHandler(u,function(t,e){t.sourcePoint.y=e}),y=this.addEdgeGeometryHandler(c,function(t,e){t.targetPoint.x=e}),S=this.addEdgeGeometryHandler(p,function(t,e){t.targetPoint.y=e});l.getModel().addListener(mxEvent.CHANGE,g),this.listeners.push({destroy:function(){l.getModel().removeListener(g)}}),g()},TextFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(TextFormatPanel,BaseFormatPanel),TextFormatPanel.prototype.init=function(){this.container.style.borderBottom="none",this.addFont(this.container)},TextFormatPanel.prototype.addFont=function(t){function e(t){return function(){return t()}}for(var F,Y,g,B,h,x,y,n=this.editorUi,S=n.editor.graph,C=this.format.getSelectionState(),i=this.createTitle(mxResources.get("font")),i=(i.style.paddingLeft="18px",i.style.paddingTop="10px",i.style.paddingBottom="6px",t.appendChild(i),this.createPanel()),l=(i.style.paddingTop="2px",i.style.paddingBottom="2px",i.style.position="relative",i.style.marginLeft="-2px",i.style.borderWidth="0px",i.className="geToolbarContainer",mxClient.IS_QUIRKS&&(i.style.display="block"),S.cellEditor.isContentEditing()&&(s=i.cloneNode(),(l=this.editorUi.toolbar.addMenu(mxResources.get("style"),mxResources.get("style"),!0,"formatBlock",s,null,!0)).style.color="rgb(112, 112, 112)",l.style.whiteSpace="nowrap",l.style.overflow="hidden",l.style.margin="0px",this.addArrow(l),l.style.width="192px",l.style.height="15px",l.getElementsByTagName("div")[0].style.cssFloat="right",t.appendChild(s)),t.appendChild(i),this.createPanel()),E=(l.style.marginTop="8px",l.style.borderTop="1px solid #c0c0c0",l.style.paddingTop="6px",l.style.paddingBottom="6px",this.editorUi.toolbar.addMenu("Helvetica",mxResources.get("fontFamily"),!0,"fontFamily",i,null,!0)),s=(E.style.color="rgb(112, 112, 112)",E.style.whiteSpace="nowrap",E.style.overflow="hidden",E.style.margin="0px",this.addArrow(E),E.style.width="192px",E.style.height="15px",i.cloneNode(!1)),f=(s.style.marginLeft="-3px",this.editorUi.toolbar.addItems(["bold","italic","underline"],s,!0)),P=(f[0].setAttribute("title",mxResources.get("bold")+" ("+this.editorUi.actions.get("bold").shortcut+")"),f[1].setAttribute("title",mxResources.get("italic")+" ("+this.editorUi.actions.get("italic").shortcut+")"),f[2].setAttribute("title",mxResources.get("underline")+" ("+this.editorUi.actions.get("underline").shortcut+")"),this.editorUi.toolbar.addItems(["vertical"],s,!0)[0]),o=(mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(s),this.styleButtons(f),this.styleButtons([P]),i.cloneNode(!1)),T=(o.style.marginLeft="-3px",o.style.paddingBottom="0px",this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),S.cellEditor.isContentEditing()?function(t){S.cellEditor.alignText(mxConstants.ALIGN_LEFT,t)}:e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT])),o)),L=this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),S.cellEditor.isContentEditing()?function(t){S.cellEditor.alignText(mxConstants.ALIGN_CENTER,t)}:e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER])),o),R=this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),S.cellEditor.isContentEditing()?function(t){S.cellEditor.alignText(mxConstants.ALIGN_RIGHT,t)}:e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT])),o),G=(this.styleButtons([T,L,R]),S.cellEditor.isContentEditing()&&(d=this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("strikethrough"),function(){document.execCommand("strikeThrough",!1,null)},s),this.styleButtons([d]),d.firstChild.style.background="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0wIDBoMjR2MjRIMFYweiIvPjwvZGVmcz48Y2xpcFBhdGggaWQ9ImIiPjx1c2UgeGxpbms6aHJlZj0iI2EiIG92ZXJmbG93PSJ2aXNpYmxlIi8+PC9jbGlwUGF0aD48cGF0aCBjbGlwLXBhdGg9InVybCgjYikiIGZpbGw9IiMwMTAxMDEiIGQ9Ik03LjI0IDguNzVjLS4yNi0uNDgtLjM5LTEuMDMtLjM5LTEuNjcgMC0uNjEuMTMtMS4xNi40LTEuNjcuMjYtLjUuNjMtLjkzIDEuMTEtMS4yOS40OC0uMzUgMS4wNS0uNjMgMS43LS44My42Ni0uMTkgMS4zOS0uMjkgMi4xOC0uMjkuODEgMCAxLjU0LjExIDIuMjEuMzQuNjYuMjIgMS4yMy41NCAxLjY5Ljk0LjQ3LjQuODMuODggMS4wOCAxLjQzLjI1LjU1LjM4IDEuMTUuMzggMS44MWgtMy4wMWMwLS4zMS0uMDUtLjU5LS4xNS0uODUtLjA5LS4yNy0uMjQtLjQ5LS40NC0uNjgtLjItLjE5LS40NS0uMzMtLjc1LS40NC0uMy0uMS0uNjYtLjE2LTEuMDYtLjE2LS4zOSAwLS43NC4wNC0xLjAzLjEzLS4yOS4wOS0uNTMuMjEtLjcyLjM2LS4xOS4xNi0uMzQuMzQtLjQ0LjU1LS4xLjIxLS4xNS40My0uMTUuNjYgMCAuNDguMjUuODguNzQgMS4yMS4zOC4yNS43Ny40OCAxLjQxLjdINy4zOWMtLjA1LS4wOC0uMTEtLjE3LS4xNS0uMjV6TTIxIDEydi0ySDN2Mmg5LjYyYy4xOC4wNy40LjE0LjU1LjIuMzcuMTcuNjYuMzQuODcuNTEuMjEuMTcuMzUuMzYuNDMuNTcuMDcuMi4xMS40My4xMS42OSAwIC4yMy0uMDUuNDUtLjE0LjY2LS4wOS4yLS4yMy4zOC0uNDIuNTMtLjE5LjE1LS40Mi4yNi0uNzEuMzUtLjI5LjA4LS42My4xMy0xLjAxLjEzLS40MyAwLS44My0uMDQtMS4xOC0uMTNzLS42Ni0uMjMtLjkxLS40MmMtLjI1LS4xOS0uNDUtLjQ0LS41OS0uNzUtLjE0LS4zMS0uMjUtLjc2LS4yNS0xLjIxSDYuNGMwIC41NS4wOCAxLjEzLjI0IDEuNTguMTYuNDUuMzcuODUuNjUgMS4yMS4yOC4zNS42LjY2Ljk4LjkyLjM3LjI2Ljc4LjQ4IDEuMjIuNjUuNDQuMTcuOS4zIDEuMzguMzkuNDguMDguOTYuMTMgMS40NC4xMy44IDAgMS41My0uMDkgMi4xOC0uMjhzMS4yMS0uNDUgMS42Ny0uNzljLjQ2LS4zNC44Mi0uNzcgMS4wNy0xLjI3cy4zOC0xLjA3LjM4LTEuNzFjMC0uNi0uMS0xLjE0LS4zMS0xLjYxLS4wNS0uMTEtLjExLS4yMy0uMTctLjMzSDIxeiIvPjwvc3ZnPg==)",d.firstChild.style.backgroundPosition="2px 2px",d.firstChild.style.backgroundSize="18px 18px",this.styleButtons([d])),this.editorUi.toolbar.addButton("geSprite-top",mxResources.get("top"),e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP])),o)),k=this.editorUi.toolbar.addButton("geSprite-middle",mxResources.get("middle"),e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE])),o),W=this.editorUi.toolbar.addButton("geSprite-bottom",mxResources.get("bottom"),e(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM])),o),o=(this.styleButtons([G,k,W]),mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(o),S.cellEditor.isContentEditing()?(G.style.display="none",k.style.display="none",W.style.display="none",P.style.display="none",(g=this.editorUi.toolbar.addButton("geSprite-justifyfull",mxResources.get("block"),function(){1==g.style.opacity&&document.execCommand("justifyfull",!1,null)},o)).style.marginRight="9px",g.style.opacity=1,this.styleButtons([g,F=this.editorUi.toolbar.addButton("geSprite-subscript",mxResources.get("subscript")+" ("+Editor.ctrlKey+"+,)",function(){document.execCommand("subscript",!1,null)},o),Y=this.editorUi.toolbar.addButton("geSprite-superscript",mxResources.get("superscript")+" ("+Editor.ctrlKey+"+.)",function(){document.execCommand("superscript",!1,null)},o)]),F.style.marginLeft="9px",(d=o.cloneNode(!1)).style.paddingTop="4px",c=[this.editorUi.toolbar.addButton("geSprite-orderedlist",mxResources.get("numberedList"),function(){document.execCommand("insertorderedlist",!1,null)},d),this.editorUi.toolbar.addButton("geSprite-unorderedlist",mxResources.get("bulletedList"),function(){document.execCommand("insertunorderedlist",!1,null)},d),this.editorUi.toolbar.addButton("geSprite-outdent",mxResources.get("decreaseIndent"),function(){document.execCommand("outdent",!1,null)},d),this.editorUi.toolbar.addButton("geSprite-indent",mxResources.get("increaseIndent"),function(){document.execCommand("indent",!1,null)},d),this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("removeFormat"),function(){document.execCommand("removeformat",!1,null)},d),this.editorUi.toolbar.addButton("geSprite-code",mxResources.get("html"),function(){S.cellEditor.toggleViewMode()},d)],this.styleButtons(c),c[c.length-2].style.marginLeft="9px",mxClient.IS_QUIRKS&&(mxUtils.br(t),d.style.height="40"),t.appendChild(d)):(f[2].style.marginRight="9px",R.style.marginRight="9px"),i.cloneNode(!1)),a=(o.style.marginLeft="0px",o.style.paddingTop="8px",o.style.paddingBottom="4px",o.style.fontWeight="normal",mxUtils.write(o,mxResources.get("position")),document.createElement("select")),H=(a.style.position="absolute",a.style.right="20px",a.style.width="97px",a.style.marginTop="-2px",["topLeft","top","topRight","left","center","right","bottomLeft","bottom","bottomRight"]),V={topLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM],top:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM],topRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM],left:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE],center:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE],right:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE],bottomLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP],bottom:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP],bottomRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP]},r=0;r<H.length;r++){var j=document.createElement("option");j.setAttribute("value",H[r]),mxUtils.write(j,mxResources.get(H[r])),a.appendChild(j)}o.appendChild(a);for(var d=i.cloneNode(!1),u=(d.style.marginLeft="0px",d.style.paddingTop="4px",d.style.paddingBottom="4px",d.style.fontWeight="normal",mxUtils.write(d,mxResources.get("writingDirection")),document.createElement("select")),z=(u.style.position="absolute",u.style.right="20px",u.style.width="97px",u.style.marginTop="-2px",["automatic","leftToRight","rightToLeft"]),K={automatic:null,leftToRight:mxConstants.TEXT_DIRECTION_LTR,rightToLeft:mxConstants.TEXT_DIRECTION_RTL},r=0;r<z.length;r++){var Q=document.createElement("option");Q.setAttribute("value",z[r]),mxUtils.write(Q,mxResources.get(z[r])),u.appendChild(Q)}d.appendChild(u),S.isEditing()||(t.appendChild(o),mxEvent.addListener(a,"change",function(t){S.getModel().beginUpdate();try{var e=V[a.value];null!=e&&(S.setCellStyles(mxConstants.STYLE_LABEL_POSITION,e[0],S.getSelectionCells()),S.setCellStyles(mxConstants.STYLE_VERTICAL_LABEL_POSITION,e[1],S.getSelectionCells()),S.setCellStyles(mxConstants.STYLE_ALIGN,e[2],S.getSelectionCells()),S.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,e[3],S.getSelectionCells()))}finally{S.getModel().endUpdate()}mxEvent.consume(t)}),t.appendChild(d),mxEvent.addListener(u,"change",function(t){S.setCellStyles(mxConstants.STYLE_TEXT_DIRECTION,K[u.value],S.getSelectionCells()),mxEvent.consume(t)}));var b=document.createElement("input"),A=(b.style.textAlign="right",b.style.marginTop="4px",mxClient.IS_QUIRKS||(b.style.position="absolute",b.style.right="32px"),b.style.width="40px",b.style.height=mxClient.IS_QUIRKS?"21px":"17px",s.appendChild(b),null),o=this.installInputHandler(b,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize,1,999," pt",function(n){if(!window.getSelection||mxClient.IS_IE||mxClient.IS_IE11){if(window.getSelection||document.selection){var t=null;if(document.selection?t=document.selection.createRange().parentElement():0<(i=window.getSelection()).rangeCount&&(t=i.getRangeAt(0).commonAncestorContainer),null!=t&&function(t,e){for(;null!=e;){if(e===t)return 1;e=e.parentNode}}(S.cellEditor.textarea,t)){A=n,document.execCommand("fontSize",!1,"4");for(l=S.cellEditor.textarea.getElementsByTagName("font"),s=0;s<l.length;s++)if("4"==l[s].getAttribute("size")){l[s].removeAttribute("size"),l[s].style.fontSize=A+"px",window.setTimeout(function(){b.value=A+" pt",A=null},0);break}}}}else{var i,t=0<(i=window.getSelection()).rangeCount?i.getRangeAt(0).commonAncestorContainer:S.cellEditor.textarea;function e(t,e){null!=S.cellEditor.textarea&&t!=S.cellEditor.textarea&&S.cellEditor.textarea.contains(t)&&(e||i.containsNode(t,!0))&&("FONT"==t.nodeName?(t.removeAttribute("size"),t.style.fontSize=n+"px"):mxUtils.getCurrentStyle(t).fontSize!=n+"px"&&(mxUtils.getCurrentStyle(t.parentNode).fontSize!=n+"px"?t.style.fontSize=n+"px":t.style.fontSize=""))}if(t!=S.cellEditor.textarea&&t.nodeType==mxConstants.NODETYPE_ELEMENT||document.execCommand("fontSize",!1,"1"),null!=(t=t!=S.cellEditor.textarea?t.parentNode:t)&&t.nodeType==mxConstants.NODETYPE_ELEMENT){var l=t.getElementsByTagName("*");e(t);for(var s=0;s<l.length;s++)e(l[s])}b.value=n+" pt"}},!0),d=this.createStepper(b,o,1,10,!0,Menus.prototype.defaultFontSize);d.style.display=b.style.display,d.style.marginTop="4px",mxClient.IS_QUIRKS||(d.style.right="20px"),s.appendChild(d);E.getElementsByTagName("div")[0].style.cssFloat="right";var m,U,c,v=null,Z="#ffffff",I=null,J="#000000",p=S.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("backgroundColor"),function(){return Z},function(t){document.execCommand("backcolor",!1,t!=mxConstants.NONE?t:"transparent")},"#ffffff",{install:function(t){v=t},destroy:function(){v=null}},null,!0):this.createCellColorOption(mxResources.get("backgroundColor"),mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#ffffff",null,function(t){S.updateLabelElements(S.getSelectionCells(),function(t){t.style.backgroundColor=null})}),X=(p.style.fontWeight="bold",this.createCellColorOption(mxResources.get("borderColor"),mxConstants.STYLE_LABEL_BORDERCOLOR,"#000000")),o=(X.style.fontWeight="bold",1<=C.vertices.length?S.stylesheet.getDefaultVertexStyle():S.stylesheet.getDefaultEdgeStyle()),s=S.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("fontColor"),function(){return J},function(t){if(mxClient.IS_FF){for(var e=S.cellEditor.textarea.getElementsByTagName("font"),n=[],i=0;i<e.length;i++)n.push({node:e[i],color:e[i].getAttribute("color")});document.execCommand("forecolor",!1,t!=mxConstants.NONE?t:"transparent");for(var l=S.cellEditor.textarea.getElementsByTagName("font"),i=0;i<l.length;i++)if(i>=n.length||l[i]!=n[i].node||l[i]==n[i].node&&l[i].getAttribute("color")!=n[i].color){var s=l[i].firstChild;if(null!=s&&"A"==s.nodeName&&null==s.nextSibling&&null!=s.firstChild){for(e=(l[i].parentNode.insertBefore(s,l[i]),s.firstChild);null!=e;){var o=e.nextSibling;l[i].appendChild(e),e=o}s.appendChild(l[i])}break}}else document.execCommand("forecolor",!1,t!=mxConstants.NONE?t:"transparent")},null!=o[mxConstants.STYLE_FONTCOLOR]?o[mxConstants.STYLE_FONTCOLOR]:"#000000",{install:function(t){I=t},destroy:function(){I=null}},null,!0):this.createCellColorOption(mxResources.get("fontColor"),mxConstants.STYLE_FONTCOLOR,null!=o[mxConstants.STYLE_FONTCOLOR]?o[mxConstants.STYLE_FONTCOLOR]:"#000000",function(t){t==mxConstants.NONE?p.style.display="none":p.style.display="",X.style.display=p.style.display},function(t){t==mxConstants.NONE?S.setCellStyles(mxConstants.STYLE_NOLABEL,"1",S.getSelectionCells()):S.setCellStyles(mxConstants.STYLE_NOLABEL,null,S.getSelectionCells()),S.updateCellStyles(mxConstants.STYLE_FONTCOLOR,t,S.getSelectionCells()),S.updateLabelElements(S.getSelectionCells(),function(t){t.removeAttribute("color"),t.style.color=null})}),d=(s.style.fontWeight="bold",l.appendChild(s),l.appendChild(p),S.cellEditor.isContentEditing()||l.appendChild(X),t.appendChild(l),this.createPanel()),o=(d.style.paddingTop="2px",d.style.paddingBottom="4px",this.createCellOption(mxResources.get("wordWrap"),mxConstants.STYLE_WHITE_SPACE,null,"wrap","null",null,null,!0)),s=(o.style.fontWeight="bold",C.containsLabel||C.autoSize||0!=C.edges.length||d.appendChild(o),this.createCellOption(mxResources.get("formattedText"),"html","0",null,null,null,n.actions.get("formattedText"))),l=(s.style.fontWeight="bold",d.appendChild(s),this.createPanel()),o=(l.style.paddingTop="10px",l.style.paddingBottom="28px",l.style.fontWeight="normal",document.createElement("div")),N=(o.style.position="absolute",o.style.width="70px",o.style.marginTop="0px",o.style.fontWeight="bold",mxUtils.write(o,mxResources.get("spacing")),l.appendChild(o),this.addUnitInput(l,"pt",91,44,function(){et.apply(this,arguments)})),_=this.addUnitInput(l,"pt",20,44,function(){tt.apply(this,arguments)}),O=(mxUtils.br(l),this.addLabel(l,mxResources.get("top"),91),this.addLabel(l,mxResources.get("global"),20),mxUtils.br(l),mxUtils.br(l),this.addUnitInput(l,"pt",162,44,function(){lt.apply(this,arguments)})),w=this.addUnitInput(l,"pt",91,44,function(){it.apply(this,arguments)}),q=this.addUnitInput(l,"pt",20,44,function(){nt.apply(this,arguments)});function M(t,e){mxClient.IS_IE&&(mxClient.IS_QUIRKS||document.documentMode<10)?t.style.filter=e?"progid:DXImageTransform.Microsoft.Gradient(StartColorStr='#c5ecff', EndColorStr='#87d4fb', GradientType=0)":"":t.style.backgroundImage=e?"linear-gradient(#c5ecff 0px,#87d4fb 100%)":""}mxUtils.br(l),this.addLabel(l,mxResources.get("left"),162),this.addLabel(l,mxResources.get("bottom"),91),this.addLabel(l,mxResources.get("right"),20),S.cellEditor.isContentEditing()?(U=m=null,t.appendChild(this.createRelativeOption(mxResources.get("lineheight"),null,null,function(t){var e=""==t.value?120:parseInt(t.value),e=Math.max(0,isNaN(e)?120:e);null!=m&&(S.cellEditor.restoreSelection(m),m=null);for(var n=S.getSelectedElement();null!=n&&n.nodeType!=mxConstants.NODETYPE_ELEMENT;)n=n.parentNode;null!=n&&n==S.cellEditor.textarea&&null!=S.cellEditor.textarea.firstChild&&("P"!=S.cellEditor.textarea.firstChild.nodeName&&(S.cellEditor.textarea.innerHTML="<p>"+S.cellEditor.textarea.innerHTML+"</p>"),n=S.cellEditor.textarea.firstChild),null!=n&&null!=S.cellEditor.textarea&&n!=S.cellEditor.textarea&&S.cellEditor.textarea.contains(n)&&(n.style.lineHeight=e+"%"),t.value=e+" %"},function(t){U=t,mxEvent.addListener(t,"mousedown",function(){document.activeElement==S.cellEditor.textarea&&(m=S.cellEditor.saveSelection())}),mxEvent.addListener(t,"touchstart",function(){document.activeElement==S.cellEditor.textarea&&(m=S.cellEditor.saveSelection())}),t.value="120 %"})),(s=i.cloneNode(!1)).style.paddingLeft="0px",o=this.editorUi.toolbar.addItems(["link","image"],s,!0),c=[this.editorUi.toolbar.addButton("geSprite-horizontalrule",mxResources.get("insertHorizontalRule"),function(){document.execCommand("inserthorizontalrule",!1)},s),this.editorUi.toolbar.addMenuFunctionInContainer(s,"geSprite-table",mxResources.get("table"),!1,mxUtils.bind(this,function(t){this.editorUi.menus.addInsertTableItem(t)}))],this.styleButtons(o),this.styleButtons(c),(o=this.createPanel()).style.paddingTop="10px",o.style.paddingBottom="10px",o.appendChild(this.createTitle(mxResources.get("insert"))),o.appendChild(s),t.appendChild(o),mxClient.IS_QUIRKS&&(o.style.height="70"),(s=i.cloneNode(!1)).style.paddingLeft="0px",c=[this.editorUi.toolbar.addButton("geSprite-insertcolumnbefore",mxResources.get("insertColumnBefore"),mxUtils.bind(this,function(){try{null!=h&&S.insertColumn(h,null!=x?x.cellIndex:0)}catch(t){this.editorUi.handleError(t)}}),s),this.editorUi.toolbar.addButton("geSprite-insertcolumnafter",mxResources.get("insertColumnAfter"),mxUtils.bind(this,function(){try{null!=h&&S.insertColumn(h,null!=x?x.cellIndex+1:-1)}catch(t){this.editorUi.handleError(t)}}),s),this.editorUi.toolbar.addButton("geSprite-deletecolumn",mxResources.get("deleteColumn"),mxUtils.bind(this,function(){try{null!=h&&null!=x&&S.deleteColumn(h,x.cellIndex)}catch(t){this.editorUi.handleError(t)}}),s),this.editorUi.toolbar.addButton("geSprite-insertrowbefore",mxResources.get("insertRowBefore"),mxUtils.bind(this,function(){try{null!=h&&null!=y&&S.insertRow(h,y.sectionRowIndex)}catch(t){this.editorUi.handleError(t)}}),s),this.editorUi.toolbar.addButton("geSprite-insertrowafter",mxResources.get("insertRowAfter"),mxUtils.bind(this,function(){try{null!=h&&null!=y&&S.insertRow(h,y.sectionRowIndex+1)}catch(t){this.editorUi.handleError(t)}}),s),this.editorUi.toolbar.addButton("geSprite-deleterow",mxResources.get("deleteRow"),mxUtils.bind(this,function(){try{null!=h&&null!=y&&S.deleteRow(h,y.sectionRowIndex)}catch(t){this.editorUi.handleError(t)}}),s)],this.styleButtons(c),c[2].style.marginRight="9px",(o=this.createPanel()).style.paddingTop="10px",o.style.paddingBottom="10px",o.appendChild(this.createTitle(mxResources.get("table"))),o.appendChild(s),mxClient.IS_QUIRKS&&(mxUtils.br(t),o.style.height="70"),(s=i.cloneNode(!1)).style.paddingLeft="0px",c=[this.editorUi.toolbar.addButton("geSprite-strokecolor",mxResources.get("borderColor"),mxUtils.bind(this,function(n){var t;null!=h&&(t=h.style.borderColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)}),this.editorUi.pickColor(t,function(t){var e=null==x||null!=n&&mxEvent.isShiftDown(n)?h:x;S.processElements(e,function(t){t.style.border=null}),null==t||t==mxConstants.NONE?(e.removeAttribute("border"),e.style.border="",e.style.borderCollapse=""):(e.setAttribute("border","1"),e.style.border="1px solid "+t,e.style.borderCollapse="collapse")}))}),s),this.editorUi.toolbar.addButton("geSprite-fillcolor",mxResources.get("backgroundColor"),mxUtils.bind(this,function(n){var t;null!=h&&(t=h.style.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)}),this.editorUi.pickColor(t,function(t){var e=null==x||null!=n&&mxEvent.isShiftDown(n)?h:x;S.processElements(e,function(t){t.style.backgroundColor=null}),null==t||t==mxConstants.NONE?e.style.backgroundColor="":e.style.backgroundColor=t}))}),s),this.editorUi.toolbar.addButton("geSprite-fit",mxResources.get("spacing"),function(){var t;null!=h&&(t=h.getAttribute("cellPadding")||0,t=new FilenameDialog(n,t,mxResources.get("apply"),mxUtils.bind(this,function(t){null!=t&&0<t.length?h.setAttribute("cellPadding",t):h.removeAttribute("cellPadding")}),mxResources.get("spacing")),n.showDialog(t.container,300,80,!0,!0),t.init())},s),this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),function(){null!=h&&h.setAttribute("align","left")},s),this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),function(){null!=h&&h.setAttribute("align","center")},s),this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),function(){null!=h&&h.setAttribute("align","right")},s)],this.styleButtons(c),c[2].style.marginRight="9px",mxClient.IS_QUIRKS&&(mxUtils.br(o),mxUtils.br(o)),o.appendChild(s),t.appendChild(o),B=o):(t.appendChild(d),t.appendChild(this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_TEXT_OPACITY)),t.appendChild(l));var $,D=mxUtils.bind(this,function(t,e,n){C=this.format.getSelectionState();var i,l=mxUtils.getValue(C.style,mxConstants.STYLE_FONTSTYLE,0),l=(M(f[0],(l&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD),M(f[1],(l&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC),M(f[2],(l&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE),E.firstChild.nodeValue=mxUtils.getValue(C.style,mxConstants.STYLE_FONTFAMILY,Menus.prototype.defaultFont),M(P,"0"==mxUtils.getValue(C.style,mxConstants.STYLE_HORIZONTAL,"1")),!n&&document.activeElement==b||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize)),b.value=isNaN(i)?"":i+" pt"),mxUtils.getValue(C.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)),l=(M(T,l==mxConstants.ALIGN_LEFT),M(L,l==mxConstants.ALIGN_CENTER),M(R,l==mxConstants.ALIGN_RIGHT),mxUtils.getValue(C.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)),l=(M(G,l==mxConstants.ALIGN_TOP),M(k,l==mxConstants.ALIGN_MIDDLE),M(W,l==mxConstants.ALIGN_BOTTOM),mxUtils.getValue(C.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER)),s=mxUtils.getValue(C.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),s=(l==mxConstants.ALIGN_LEFT&&s==mxConstants.ALIGN_TOP?a.value="topLeft":l==mxConstants.ALIGN_CENTER&&s==mxConstants.ALIGN_TOP?a.value="top":l==mxConstants.ALIGN_RIGHT&&s==mxConstants.ALIGN_TOP?a.value="topRight":l==mxConstants.ALIGN_LEFT&&s==mxConstants.ALIGN_BOTTOM?a.value="bottomLeft":l==mxConstants.ALIGN_CENTER&&s==mxConstants.ALIGN_BOTTOM?a.value="bottom":l==mxConstants.ALIGN_RIGHT&&s==mxConstants.ALIGN_BOTTOM?a.value="bottomRight":l==mxConstants.ALIGN_LEFT?a.value="left":l==mxConstants.ALIGN_RIGHT?a.value="right":a.value="center",mxUtils.getValue(C.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION));s==mxConstants.TEXT_DIRECTION_RTL?u.value="rightToLeft":s==mxConstants.TEXT_DIRECTION_LTR?u.value="leftToRight":s==mxConstants.TEXT_DIRECTION_AUTO&&(u.value="automatic"),!n&&document.activeElement==_||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_SPACING,2)),_.value=isNaN(i)?"":i+" pt"),!n&&document.activeElement==N||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_SPACING_TOP,0)),N.value=isNaN(i)?"":i+" pt"),!n&&document.activeElement==q||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_SPACING_RIGHT,0)),q.value=isNaN(i)?"":i+" pt"),!n&&document.activeElement==w||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_SPACING_BOTTOM,0)),w.value=isNaN(i)?"":i+" pt"),!n&&document.activeElement==O||(i=parseFloat(mxUtils.getValue(C.style,mxConstants.STYLE_SPACING_LEFT,0)),O.value=isNaN(i)?"":i+" pt")}),tt=this.installInputHandler(_,mxConstants.STYLE_SPACING,2,-999,999," pt"),et=this.installInputHandler(N,mxConstants.STYLE_SPACING_TOP,0,-999,999," pt"),nt=this.installInputHandler(q,mxConstants.STYLE_SPACING_RIGHT,0,-999,999," pt"),it=this.installInputHandler(w,mxConstants.STYLE_SPACING_BOTTOM,0,-999,999," pt"),lt=this.installInputHandler(O,mxConstants.STYLE_SPACING_LEFT,0,-999,999," pt");return this.addKeyHandler(b,D),this.addKeyHandler(_,D),this.addKeyHandler(N,D),this.addKeyHandler(q,D),this.addKeyHandler(w,D),this.addKeyHandler(O,D),S.getModel().addListener(mxEvent.CHANGE,D),this.listeners.push({destroy:function(){S.getModel().removeListener(D)}}),D(),S.cellEditor.isContentEditing()&&($=!1,i=function(){$||($=!0,window.setTimeout(function(){var n=S.getSelectedEditingElement();if(null!=n){function t(t,e,n){return null!=n.style&&null!=e?(e=e.lineHeight,null!=n.style.lineHeight&&"%"==n.style.lineHeight.substring(n.style.lineHeight.length-1)?parseInt(n.style.lineHeight)/100:"px"==e.substring(e.length-2)?parseFloat(e)/t:parseInt(e)):""}function e(t){t=null!=t?t.fontSize:null;return null!=t&&"px"==t.substring(t.length-2)?parseFloat(t):mxConstants.DEFAULT_FONTSIZE}var i,l,s=mxUtils.getCurrentStyle(n),o=e(s),a=t(o,s,n),r=n.getElementsByTagName("*");if(0<r.length&&window.getSelection&&!mxClient.IS_IE&&!mxClient.IS_IE11)for(var d,u=window.getSelection(),m=0;m<r.length;m++)u.containsNode(r[m],!0)&&(temp=mxUtils.getCurrentStyle(r[m]),(d=t(o=Math.max(e(temp),o),temp,r[m]))==a&&!isNaN(d)||(a=""));function c(t){if(null!=S.getParentByName(n,t,S.cellEditor.textarea))return!0;for(var e=n;null!=e&&1==e.childNodes.length;)if((e=e.childNodes[0]).nodeName==t)return!0;return!1}function p(t,e){if(null!=t&&null!=e){if(t==e)return!0;if(t.length>e.length+1)return t.substring(t.length-e.length-1,t.length)=="-"+e}return!1}null!=s&&(M(f[0],"bold"==s.fontWeight||400<s.fontWeight||c("B")||c("STRONG")),M(f[1],"italic"==s.fontStyle||c("I")||c("EM")),M(f[2],c("U")),M(Y,c("SUP")),M(F,c("SUB")),S.cellEditor.isTableSelected()?(M(g,p(s.textAlign,"justify")),M(T,p(s.textAlign,"left")),M(L,p(s.textAlign,"center")),M(R,p(s.textAlign,"right"))):(i=S.cellEditor.align||mxUtils.getValue(C.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),p(s.textAlign,"justify")?(M(g,p(s.textAlign,"justify")),M(T,!1),M(L,!1),M(R,!1)):(M(g,!1),M(T,i==mxConstants.ALIGN_LEFT),M(L,i==mxConstants.ALIGN_CENTER),M(R,i==mxConstants.ALIGN_RIGHT))),h=S.getParentByName(n,"TABLE",S.cellEditor.textarea),y=null==h?null:S.getParentByName(n,"TR",h),x=null==h?null:S.getParentByNames(n,["TD","TH"],h),B.style.display=null!=h?"":"none",document.activeElement!=b&&("FONT"==n.nodeName&&"4"==n.getAttribute("size")&&null!=A?(n.removeAttribute("size"),n.style.fontSize=A+" pt",A=null):b.value=isNaN(o)?"":o+" pt",d=parseFloat(a),isNaN(d)?U.value="100 %":U.value=Math.round(100*d)+" %"),i=s.color.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)}),l=s.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)}),null!=I&&(J="#"==i.charAt(0)?i:"#000000",I(J,!0)),null!=v&&(Z="#"==l.charAt(0)?l:null,v(Z,!0)),null!=E.firstChild&&(E.firstChild.nodeValue=Graph.stripQuotes(s.fontFamily)))}$=!1},0))},(mxClient.IS_FF||mxClient.IS_EDGE||mxClient.IS_IE||mxClient.IS_IE11)&&mxEvent.addListener(S.cellEditor.textarea,"DOMSubtreeModified",i),mxEvent.addListener(S.cellEditor.textarea,"input",i),mxEvent.addListener(S.cellEditor.textarea,"touchend",i),mxEvent.addListener(S.cellEditor.textarea,"mouseup",i),mxEvent.addListener(S.cellEditor.textarea,"keyup",i),this.listeners.push({destroy:function(){}}),i()),t},StyleFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(StyleFormatPanel,BaseFormatPanel),StyleFormatPanel.prototype.defaultStrokeColor="black",StyleFormatPanel.prototype.init=function(){this.editorUi.editor.graph;var t=this.format.getSelectionState(),t=(t.containsLabel||(t.containsImage&&1==t.vertices.length&&"image"==t.style.shape&&null!=t.style.image&&"data:image/svg+xml;"==t.style.image.substring(0,19)&&this.container.appendChild(this.addSvgStyles(this.createPanel())),t.containsImage&&"image"!=t.style.shape||this.container.appendChild(this.addFill(this.createPanel())),this.container.appendChild(this.addStroke(this.createPanel())),this.container.appendChild(this.addLineJumps(this.createPanel())),(t=this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_OPACITY,41)).style.paddingTop="8px",t.style.paddingBottom="8px",this.container.appendChild(t),this.container.appendChild(this.addEffects(this.createPanel()))),this.addEditOps(this.createPanel()));null!=t.firstChild&&mxUtils.br(t),this.container.appendChild(this.addStyleOps(t))},StyleFormatPanel.prototype.getCssRules=function(t){var e=document.implementation.createHTMLDocument(""),n=document.createElement("style");return mxUtils.setTextContent(n,t),e.body.appendChild(n),n.sheet.cssRules},StyleFormatPanel.prototype.addSvgStyles=function(t){this.editorUi.editor.graph;var e=this.format.getSelectionState();t.style.paddingTop="6px",t.style.paddingBottom="6px",t.style.fontWeight="bold",t.style.display="none";try{var n=e.style.editableCssRules;if(null!=n){var i=new RegExp(n),l=e.style.image.substring(e.style.image.indexOf(",")+1),s=window.atob?atob(l):Base64.decode(l,!0),o=mxUtils.parseXml(s);if(null!=o)for(var a=o.getElementsByTagName("style"),r=0;r<a.length;r++)for(var d=this.getCssRules(mxUtils.getTextContent(a[r])),u=0;u<d.length;u++)this.addSvgRule(t,d[u],o,a[r],d,u,i)}}catch(t){}return t},StyleFormatPanel.prototype.addSvgRule=function(l,t,s,o,a,r,e){var d=this.editorUi.editor.graph;e.test(t.selectorText)&&((e=mxUtils.bind(this,function(t,i,e){var n=mxUtils.trim(t.style[i]);""!=n&&"url("!=n.substring(0,4)&&(e=this.createColorOption(e+" "+t.selectorText,function(){return(t=(t=n).match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):"";var t},function(t){a[r].style[i]=t;for(var e="",n=0;n<a.length;n++)e+=a[n].cssText+" ";o.textContent=e;t=mxUtils.getXml(s.documentElement);d.setCellStyles(mxConstants.STYLE_IMAGE,"data:image/svg+xml,"+(window.btoa?btoa(t):Base64.encode(t,!0)),d.getSelectionCells())},"#ffffff",{install:function(t){},destroy:function(){}}),l.appendChild(e),l.style.display="")}))(t,"fill",mxResources.get("fill")),e(t,"stroke",mxResources.get("line")),e(t,"stop-color",mxResources.get("gradient")))},StyleFormatPanel.prototype.addEditOps=function(t){var e=this.format.getSelectionState(),n=null;return 1==this.editorUi.editor.graph.getSelectionCount()&&((n=mxUtils.button(mxResources.get("editStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editStyle").funct()}))).setAttribute("title",mxResources.get("editStyle")+" ("+this.editorUi.actions.get("editStyle").shortcut+")"),n.style.width="202px",n.style.marginBottom="2px",t.appendChild(n)),e.image&&((e=mxUtils.button(mxResources.get("editImage"),mxUtils.bind(this,function(t){this.editorUi.actions.get("image").funct()}))).setAttribute("title",mxResources.get("editImage")),e.style.marginBottom="2px",null==n?e.style.width="202px":(n.style.width="100px",e.style.width="100px",e.style.marginLeft="2px"),t.appendChild(e)),t},StyleFormatPanel.prototype.addFill=function(n){for(var e=this.editorUi.editor.graph,i=this.format.getSelectionState(),l=(n.style.paddingTop="6px",n.style.paddingBottom="6px",document.createElement("select")),s=(l.style.position="absolute",l.style.marginTop="-2px",l.style.right=mxClient.IS_QUIRKS?"52px":"72px",l.style.width="70px",l.cloneNode(!1)),t=(mxEvent.addListener(l,"click",function(t){mxEvent.consume(t)}),mxEvent.addListener(s,"click",function(t){mxEvent.consume(t)}),1<=i.vertices.length?e.stylesheet.getDefaultVertexStyle():e.stylesheet.getDefaultEdgeStyle()),o=this.createCellColorOption(mxResources.get("gradient"),mxConstants.STYLE_GRADIENTCOLOR,null!=t[mxConstants.STYLE_GRADIENTCOLOR]?t[mxConstants.STYLE_GRADIENTCOLOR]:"#ffffff",function(t){null==t||t==mxConstants.NONE?l.style.display="none":l.style.display=""},function(t){e.updateCellStyles(mxConstants.STYLE_GRADIENTCOLOR,t,e.getSelectionCells())}),a="image"==i.style.shape?mxConstants.STYLE_IMAGE_BACKGROUND:mxConstants.STYLE_FILLCOLOR,r="image"==i.style.shape?mxResources.get("background"):mxResources.get("fill"),t=1<=i.vertices.length?e.stylesheet.getDefaultVertexStyle():e.stylesheet.getDefaultEdgeStyle(),r=this.createCellColorOption(r,a,null!=t[a]?t[a]:"#ffffff",null,mxUtils.bind(this,function(t){e.updateCellStyles(a,t,e.getSelectionCells())})),t=(r.style.fontWeight="bold",mxUtils.getValue(i.style,a,null)),d=(o.style.display=null!=t&&t!=mxConstants.NONE&&i.fill&&"image"!=i.style.shape?"":"none",[mxConstants.DIRECTION_NORTH,mxConstants.DIRECTION_EAST,mxConstants.DIRECTION_SOUTH,mxConstants.DIRECTION_WEST]),u=0;u<d.length;u++){var m=document.createElement("option");m.setAttribute("value",d[u]),mxUtils.write(m,mxResources.get(d[u])),l.appendChild(m)}o.appendChild(l);for(u=0;u<Editor.roughFillStyles.length;u++){var c=document.createElement("option");c.setAttribute("value",Editor.roughFillStyles[u].val),mxUtils.write(c,Editor.roughFillStyles[u].dispName),s.appendChild(c)}r.appendChild(s);for(var p=mxUtils.bind(this,function(){i=this.format.getSelectionState();var t=mxUtils.getValue(i.style,mxConstants.STYLE_GRADIENT_DIRECTION,mxConstants.DIRECTION_SOUTH),e=mxUtils.getValue(i.style,"fillStyle","auto"),t=(""==t&&(t=mxConstants.DIRECTION_SOUTH),l.value=t,s.value=e,n.style.display=i.fill?"":"none",mxUtils.getValue(i.style,mxConstants.STYLE_FILLCOLOR,null));!i.fill||i.containsImage||null==t||t==mxConstants.NONE||"filledEdge"==i.style.shape?(s.style.display="none",o.style.display="none"):(s.style.display="1"==i.style.sketch?"":"none",o.style.display="1"!=i.style.sketch||"solid"==e||"auto"==e?"":"none")}),g=(e.getModel().addListener(mxEvent.CHANGE,p),this.listeners.push({destroy:function(){e.getModel().removeListener(p)}}),p(),mxEvent.addListener(l,"change",function(t){e.setCellStyles(mxConstants.STYLE_GRADIENT_DIRECTION,l.value,e.getSelectionCells()),mxEvent.consume(t)}),mxEvent.addListener(s,"change",function(t){e.setCellStyles("fillStyle",s.value,e.getSelectionCells()),mxEvent.consume(t)}),n.appendChild(r),n.appendChild(o),this.getCustomColors()),u=0;u<g.length;u++)n.appendChild(this.createCellColorOption(g[u].title,g[u].key,g[u].defaultValue));return n},StyleFormatPanel.prototype.getCustomColors=function(){var t=this.format.getSelectionState(),e=[];return"swimlane"!=t.style.shape&&"table"!=t.style.shape||e.push({title:mxResources.get("laneColor"),key:"swimlaneFillColor",defaultValue:"#ffffff"}),e},StyleFormatPanel.prototype.addStroke=function(t){for(var a=this.editorUi,r=a.editor.graph,d=this.format.getSelectionState(),e=(t.style.paddingTop="4px",t.style.paddingBottom="4px",t.style.whiteSpace="normal",document.createElement("div")),u=(e.style.fontWeight="bold",d.stroke||(e.style.display="none"),document.createElement("select")),n=(u.style.position="absolute",u.style.marginTop="-2px",u.style.right="72px",u.style.width="80px",["sharp","rounded","curved"]),i=0;i<n.length;i++){var l=document.createElement("option");l.setAttribute("value",n[i]),mxUtils.write(l,mxResources.get(n[i])),u.appendChild(l)}mxEvent.addListener(u,"change",function(t){r.getModel().beginUpdate();try{var e=[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],n=["0",null];"rounded"==u.value?n=["1",null]:"curved"==u.value&&(n=[null,"1"]);for(var i=0;i<e.length;i++)r.setCellStyles(e[i],n[i],r.getSelectionCells());a.fireEvent(new mxEventObject("styleChanged","keys",e,"values",n,"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}mxEvent.consume(t)}),mxEvent.addListener(u,"click",function(t){mxEvent.consume(t)});var m="image"==d.style.shape?mxConstants.STYLE_IMAGE_BORDER:mxConstants.STYLE_STROKECOLOR,s="image"==d.style.shape?mxResources.get("border"):mxResources.get("line"),o=1<=d.vertices.length?r.stylesheet.getDefaultVertexStyle():r.stylesheet.getDefaultEdgeStyle(),s=this.createCellColorOption(s,m,null!=o[m]?o[m]:"#000000",null,mxUtils.bind(this,function(t){r.updateCellStyles(m,t,r.getSelectionCells())})),c=(s.appendChild(u),e.appendChild(s),e.cloneNode(!1)),p=(c.style.fontWeight="normal",c.style.whiteSpace="nowrap",c.style.position="relative",c.style.paddingLeft="16px",c.style.marginBottom="2px",c.style.marginTop="2px",c.className="geToolbarContainer",mxUtils.bind(this,function(t,e,n,i,l){t=this.editorUi.menus.styleChange(t,"",i,l,"geIcon",null),i=document.createElement("div");return i.style.width=e+"px",i.style.height="1px",i.style.borderBottom="1px "+n+" "+this.defaultStrokeColor,i.style.paddingTop="6px",t.firstChild.firstChild.style.padding="0px 4px 0px 4px",t.firstChild.firstChild.style.width=e+"px",t.firstChild.firstChild.appendChild(i),t})),o=this.editorUi.toolbar.addMenuFunctionInContainer(c,"geSprite-orthogonal",mxResources.get("pattern"),!1,mxUtils.bind(this,function(t){p(t,75,"solid",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],[null,null]).setAttribute("title",mxResources.get("solid")),p(t,75,"dashed",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1",null]).setAttribute("title",mxResources.get("dashed")),p(t,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 1"]).setAttribute("title",mxResources.get("dotted")+" (1)"),p(t,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 2"]).setAttribute("title",mxResources.get("dotted")+" (2)"),p(t,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 4"]).setAttribute("title",mxResources.get("dotted")+" (3)")})),g=c.cloneNode(!1),h=this.editorUi.toolbar.addMenuFunctionInContainer(g,"geSprite-connection",mxResources.get("connection"),!1,mxUtils.bind(this,function(t){this.editorUi.menus.styleChange(t,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],[null,null,null,null],"geIcon geSprite geSprite-connection",null,!0).setAttribute("title",mxResources.get("line")),this.editorUi.menus.styleChange(t,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["link",null,null,null],"geIcon geSprite geSprite-linkedge",null,!0).setAttribute("title",mxResources.get("link")),this.editorUi.menus.styleChange(t,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["flexArrow",null,null,null],"geIcon geSprite geSprite-arrow",null,!0).setAttribute("title",mxResources.get("arrow")),this.editorUi.menus.styleChange(t,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["arrow",null,null,null],"geIcon geSprite geSprite-simplearrow",null,!0).setAttribute("title",mxResources.get("simpleArrow"))})),s=this.editorUi.toolbar.addMenuFunctionInContainer(g,"geSprite-orthogonal",mxResources.get("pattern"),!1,mxUtils.bind(this,function(t){p(t,33,"solid",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],[null,null]).setAttribute("title",mxResources.get("solid")),p(t,33,"dashed",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1",null]).setAttribute("title",mxResources.get("dashed")),p(t,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 1"]).setAttribute("title",mxResources.get("dotted")+" (1)"),p(t,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 2"]).setAttribute("title",mxResources.get("dotted")+" (2)"),p(t,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 4"]).setAttribute("title",mxResources.get("dotted")+" (3)")})),x=c.cloneNode(!1),y=document.createElement("input"),S=(y.style.textAlign="right",y.style.marginTop="2px",y.style.width="41px",y.setAttribute("title",mxResources.get("linewidth")),c.appendChild(y),y.cloneNode(!0));function C(t){var e=parseInt(y.value);(e=Math.min(999,Math.max(1,isNaN(e)?1:e)))!=mxUtils.getValue(d.style,mxConstants.STYLE_STROKEWIDTH,1)&&(r.setCellStyles(mxConstants.STYLE_STROKEWIDTH,e,r.getSelectionCells()),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[e],"cells",r.getSelectionCells()))),y.value=e+" pt",mxEvent.consume(t)}function E(t){var e=parseInt(S.value);(e=Math.min(999,Math.max(1,isNaN(e)?1:e)))!=mxUtils.getValue(d.style,mxConstants.STYLE_STROKEWIDTH,1)&&(r.setCellStyles(mxConstants.STYLE_STROKEWIDTH,e,r.getSelectionCells()),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[e],"cells",r.getSelectionCells()))),S.value=e+" pt",mxEvent.consume(t)}g.appendChild(S);var f=this.createStepper(y,C,1,9),T=(f.style.display=y.style.display,f.style.marginTop="2px",c.appendChild(f),this.createStepper(S,E,1,9)),L=(T.style.display=S.style.display,T.style.marginTop="2px",g.appendChild(T),mxClient.IS_QUIRKS?(y.style.height="17px",S.style.height="17px"):(y.style.position="absolute",y.style.height="15px",y.style.left="141px",f.style.left="190px",S.style.position="absolute",S.style.left="141px",S.style.height="15px",T.style.left="190px"),mxEvent.addListener(y,"blur",C),mxEvent.addListener(y,"change",C),mxEvent.addListener(S,"blur",E),mxEvent.addListener(S,"change",E),mxClient.IS_QUIRKS&&(mxUtils.br(x),mxUtils.br(x)),this.editorUi.toolbar.addMenuFunctionInContainer(x,"geSprite-orthogonal",mxResources.get("waypoints"),!1,mxUtils.bind(this,function(t){"arrow"!=d.style.shape&&(this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],[null,null,null],"geIcon geSprite geSprite-straight",null,!0).setAttribute("title",mxResources.get("straight")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle",null,null],"geIcon geSprite geSprite-orthogonal",null,!0).setAttribute("title",mxResources.get("orthogonal")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalelbow",null,!0).setAttribute("title",mxResources.get("simple")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalelbow",null,!0).setAttribute("title",mxResources.get("simple")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalisometric",null,!0).setAttribute("title",mxResources.get("isometric")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalisometric",null,!0).setAttribute("title",mxResources.get("isometric")),"connector"==d.style.shape&&this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle","1",null],"geIcon geSprite geSprite-curved",null,!0).setAttribute("title",mxResources.get("curved")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["entityRelationEdgeStyle",null,null],"geIcon geSprite geSprite-entity",null,!0).setAttribute("title",mxResources.get("entityRelation")))}))),R=this.editorUi.toolbar.addMenuFunctionInContainer(x,"geSprite-startclassic",mxResources.get("linestart"),!1,mxUtils.bind(this,function(t){var e;"connector"!=d.style.shape&&"flexArrow"!=d.style.shape&&"filledEdge"!=d.style.shape||((e=this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.NONE,0],"geIcon",null,!1)).setAttribute("title",mxResources.get("none")),e.firstChild.firstChild.innerHTML='<font style="font-size:10px;">'+mxUtils.htmlEntities(mxResources.get("none"))+"</font>","connector"==d.style.shape||"filledEdge"==d.style.shape?(this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC,1],"geIcon geSprite geSprite-startclassic",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC_THIN,1],"geIcon geSprite geSprite-startclassicthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OPEN,0],"geIcon geSprite geSprite-startopen",null,!1).setAttribute("title",mxResources.get("openArrow")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OPEN_THIN,0],"geIcon geSprite geSprite-startopenthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["openAsync",0],"geIcon geSprite geSprite-startopenasync",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK,1],"geIcon geSprite geSprite-startblock",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK_THIN,1],"geIcon geSprite geSprite-startblockthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["async",1],"geIcon geSprite geSprite-startasync",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OVAL,1],"geIcon geSprite geSprite-startoval",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND,1],"geIcon geSprite geSprite-startdiamond",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND_THIN,1],"geIcon geSprite geSprite-startthindiamond",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC,0],"geIcon geSprite geSprite-startclassictrans",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC_THIN,0],"geIcon geSprite geSprite-startclassicthintrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK,0],"geIcon geSprite geSprite-startblocktrans",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK_THIN,0],"geIcon geSprite geSprite-startblockthintrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["async",0],"geIcon geSprite geSprite-startasynctrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OVAL,0],"geIcon geSprite geSprite-startovaltrans",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND,0],"geIcon geSprite geSprite-startdiamondtrans",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND_THIN,0],"geIcon geSprite geSprite-startthindiamondtrans",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["box",0],"geIcon geSprite geSvgSprite geSprite-box",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["halfCircle",0],"geIcon geSprite geSvgSprite geSprite-halfCircle",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["dash",0],"geIcon geSprite geSprite-startdash",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["cross",0],"geIcon geSprite geSprite-startcross",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["circlePlus",0],"geIcon geSprite geSprite-startcircleplus",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["circle",1],"geIcon geSprite geSprite-startcircle",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERone",0],"geIcon geSprite geSprite-starterone",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERmandOne",0],"geIcon geSprite geSprite-starteronetoone",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERmany",0],"geIcon geSprite geSprite-startermany",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERoneToMany",0],"geIcon geSprite geSprite-starteronetomany",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERzeroToOne",1],"geIcon geSprite geSprite-starteroneopt",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERzeroToMany",1],"geIcon geSprite geSprite-startermanyopt",null,!1)):this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_BLOCK],"geIcon geSprite geSprite-startblocktrans",null,!1).setAttribute("title",mxResources.get("block")))})),b=this.editorUi.toolbar.addMenuFunctionInContainer(x,"geSprite-endclassic",mxResources.get("lineend"),!1,mxUtils.bind(this,function(t){var e;"connector"!=d.style.shape&&"flexArrow"!=d.style.shape&&"filledEdge"!=d.style.shape||((e=this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.NONE,0],"geIcon",null,!1)).setAttribute("title",mxResources.get("none")),e.firstChild.firstChild.innerHTML='<font style="font-size:10px;">'+mxUtils.htmlEntities(mxResources.get("none"))+"</font>","connector"==d.style.shape||"filledEdge"==d.style.shape?(this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC,1],"geIcon geSprite geSprite-endclassic",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC_THIN,1],"geIcon geSprite geSprite-endclassicthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OPEN,0],"geIcon geSprite geSprite-endopen",null,!1).setAttribute("title",mxResources.get("openArrow")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OPEN_THIN,0],"geIcon geSprite geSprite-endopenthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["openAsync",0],"geIcon geSprite geSprite-endopenasync",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK,1],"geIcon geSprite geSprite-endblock",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK_THIN,1],"geIcon geSprite geSprite-endblockthin",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["async",1],"geIcon geSprite geSprite-endasync",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OVAL,1],"geIcon geSprite geSprite-endoval",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND,1],"geIcon geSprite geSprite-enddiamond",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND_THIN,1],"geIcon geSprite geSprite-endthindiamond",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC,0],"geIcon geSprite geSprite-endclassictrans",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC_THIN,0],"geIcon geSprite geSprite-endclassicthintrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK,0],"geIcon geSprite geSprite-endblocktrans",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK_THIN,0],"geIcon geSprite geSprite-endblockthintrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["async",0],"geIcon geSprite geSprite-endasynctrans",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OVAL,0],"geIcon geSprite geSprite-endovaltrans",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND,0],"geIcon geSprite geSprite-enddiamondtrans",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND_THIN,0],"geIcon geSprite geSprite-endthindiamondtrans",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["box",0],"geIcon geSprite geSvgSprite geFlipSprite geSprite-box",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["halfCircle",0],"geIcon geSprite geSvgSprite geFlipSprite geSprite-halfCircle",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["dash",0],"geIcon geSprite geSprite-enddash",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["cross",0],"geIcon geSprite geSprite-endcross",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["circlePlus",0],"geIcon geSprite geSprite-endcircleplus",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["circle",1],"geIcon geSprite geSprite-endcircle",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERone",0],"geIcon geSprite geSprite-enderone",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERmandOne",0],"geIcon geSprite geSprite-enderonetoone",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERmany",0],"geIcon geSprite geSprite-endermany",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERoneToMany",0],"geIcon geSprite geSprite-enderonetomany",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERzeroToOne",1],"geIcon geSprite geSprite-enderoneopt",null,!1),this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERzeroToMany",1],"geIcon geSprite geSprite-endermanyopt",null,!1)):this.editorUi.menus.edgeStyleChange(t,"",[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_BLOCK],"geIcon geSprite geSprite-endblocktrans",null,!1).setAttribute("title",mxResources.get("block")))})),f=(this.addArrow(h,8),this.addArrow(L),this.addArrow(R),this.addArrow(b),this.addArrow(o,9)),T=(f.className="geIcon",f.style.width="auto",this.addArrow(s,9)),A=(T.className="geIcon",T.style.width="22px",document.createElement("div")),U=(A.style.width="85px",A.style.height="1px",A.style.borderBottom="1px solid "+this.defaultStrokeColor,A.style.marginBottom="9px",f.appendChild(A),document.createElement("div")),f=(U.style.width="23px",U.style.height="1px",U.style.borderBottom="1px solid "+this.defaultStrokeColor,U.style.marginBottom="9px",T.appendChild(U),o.style.height="15px",s.style.height="15px",h.style.height="15px",L.style.height="17px",R.style.marginLeft="3px",R.style.height="17px",b.style.marginLeft="3px",b.style.height="17px",t.appendChild(e),t.appendChild(g),t.appendChild(c),c.cloneNode(!1)),T=(f.style.paddingBottom="6px",f.style.paddingTop="4px",f.style.fontWeight="normal",document.createElement("div")),v=(T.style.position="absolute",T.style.marginLeft="3px",T.style.marginBottom="12px",T.style.marginTop="2px",T.style.fontWeight="normal",T.style.width="76px",mxUtils.write(T,mxResources.get("lineend")),f.appendChild(T),this.addUnitInput(f,"pt",74,33,function(){Y.apply(this,arguments)})),I=this.addUnitInput(f,"pt",20,33,function(){F.apply(this,arguments)}),o=(mxUtils.br(f),document.createElement("div")),N=(o.style.height="8px",f.appendChild(o),T=T.cloneNode(!1),mxUtils.write(T,mxResources.get("linestart")),f.appendChild(T),this.addUnitInput(f,"pt",74,33,function(){D.apply(this,arguments)})),_=this.addUnitInput(f,"pt",20,33,function(){M.apply(this,arguments)}),s=(mxUtils.br(f),this.addLabel(f,mxResources.get("spacing"),74,50),this.addLabel(f,mxResources.get("size"),20,50),mxUtils.br(f),e.cloneNode(!1));s.style.fontWeight="normal",s.style.position="relative",s.style.paddingLeft="16px",s.style.marginBottom="2px",s.style.marginTop="6px",s.style.borderWidth="0px",s.style.paddingBottom="18px";(T=document.createElement("div")).style.position="absolute",T.style.marginLeft="3px",T.style.marginBottom="12px",T.style.marginTop="1px",T.style.fontWeight="normal",T.style.width="120px",mxUtils.write(T,mxResources.get("perimeter")),s.appendChild(T);var O=this.addUnitInput(s,"pt",20,41,function(){B.apply(this,arguments)}),w=(d.edges.length==r.getSelectionCount()?(t.appendChild(x),mxClient.IS_QUIRKS&&(mxUtils.br(t),mxUtils.br(t)),t.appendChild(f)):d.vertices.length==r.getSelectionCount()&&(mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(s)),mxUtils.bind(this,function(t,e,n){d=this.format.getSelectionState();mxUtils.getValue(d.style,m,null);!n&&document.activeElement==y||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_STROKEWIDTH,1)),y.value=isNaN(s)?"":s+" pt"),!n&&document.activeElement==S||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_STROKEWIDTH,1)),S.value=isNaN(s)?"":s+" pt"),u.style.visibility="connector"==d.style.shape||"filledEdge"==d.style.shape?"":"hidden","1"==mxUtils.getValue(d.style,mxConstants.STYLE_CURVED,null)?u.value="curved":"1"==mxUtils.getValue(d.style,mxConstants.STYLE_ROUNDED,null)&&(u.value="rounded"),"1"==mxUtils.getValue(d.style,mxConstants.STYLE_DASHED,null)?null==mxUtils.getValue(d.style,mxConstants.STYLE_DASH_PATTERN,null)?A.style.borderBottom="1px dashed "+this.defaultStrokeColor:A.style.borderBottom="1px dotted "+this.defaultStrokeColor:A.style.borderBottom="1px solid "+this.defaultStrokeColor,U.style.borderBottom=A.style.borderBottom;var i=L.getElementsByTagName("div")[0],i=(null!=i&&(o=mxUtils.getValue(d.style,mxConstants.STYLE_EDGE,null),"orthogonalEdgeStyle"==(o="1"==mxUtils.getValue(d.style,mxConstants.STYLE_NOEDGESTYLE,null)?null:o)&&"1"==mxUtils.getValue(d.style,mxConstants.STYLE_CURVED,null)?i.className="geSprite geSprite-curved":i.className="straight"==o||"none"==o||null==o?"geSprite geSprite-straight":"entityRelationEdgeStyle"==o?"geSprite geSprite-entity":"elbowEdgeStyle"==o?"geSprite "+("vertical"==mxUtils.getValue(d.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalelbow":"geSprite-horizontalelbow"):"isometricEdgeStyle"==o?"geSprite "+("vertical"==mxUtils.getValue(d.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalisometric":"geSprite-horizontalisometric"):"geSprite geSprite-orthogonal"),h.getElementsByTagName("div")[0]);function l(t,e,n,i){n=n.getElementsByTagName("div")[0];return null!=n&&(n.className=a.getCssClassForMarker(i,d.style.shape,t,e),"geSprite geSprite-noarrow"==n.className&&(n.innerHTML=mxUtils.htmlEntities(mxResources.get("none")),n.style.backgroundImage="none",n.style.verticalAlign="top",n.style.marginTop="5px",n.style.fontSize="10px",n.style.filter="none",n.style.color=this.defaultStrokeColor,n.nextSibling.style.marginTop="0px")),n}null!=i&&("link"==d.style.shape?i.className="geSprite geSprite-linkedge":"flexArrow"==d.style.shape?i.className="geSprite geSprite-arrow":"arrow"==d.style.shape?i.className="geSprite geSprite-simplearrow":i.className="geSprite geSprite-connection"),d.edges.length==r.getSelectionCount()?(g.style.display="",c.style.display="none"):(g.style.display="none",c.style.display="");var s,o=l(mxUtils.getValue(d.style,mxConstants.STYLE_STARTARROW,null),mxUtils.getValue(d.style,"startFill","1"),R,"start"),i=l(mxUtils.getValue(d.style,mxConstants.STYLE_ENDARROW,null),mxUtils.getValue(d.style,"endFill","1"),b,"end");null!=o&&null!=i&&("arrow"==d.style.shape?(o.className="geSprite geSprite-noarrow",i.className="geSprite geSprite-endblocktrans"):"link"==d.style.shape&&(o.className="geSprite geSprite-noarrow",i.className="geSprite geSprite-noarrow")),mxUtils.setOpacity(L,"arrow"==d.style.shape?30:100),"connector"!=d.style.shape&&"flexArrow"!=d.style.shape&&"filledEdge"!=d.style.shape?(mxUtils.setOpacity(R,30),mxUtils.setOpacity(b,30)):(mxUtils.setOpacity(R,100),mxUtils.setOpacity(b,100)),!n&&document.activeElement==_||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)),_.value=isNaN(s)?"":s+" pt"),!n&&document.activeElement==N||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0)),N.value=isNaN(s)?"":s+" pt"),!n&&document.activeElement==I||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE)),I.value=isNaN(s)?"":s+" pt"),!n&&document.activeElement==N||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0)),v.value=isNaN(s)?"":s+" pt"),!n&&document.activeElement==O||(s=parseInt(mxUtils.getValue(d.style,mxConstants.STYLE_PERIMETER_SPACING,0)),O.value=isNaN(s)?"":s+" pt")})),M=this.installInputHandler(_,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),D=this.installInputHandler(N,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0,-999,999," pt"),F=this.installInputHandler(I,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),Y=this.installInputHandler(v,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0,-999,999," pt"),B=this.installInputHandler(O,mxConstants.STYLE_PERIMETER_SPACING,0,0,999," pt");return this.addKeyHandler(y,w),this.addKeyHandler(_,w),this.addKeyHandler(N,w),this.addKeyHandler(I,w),this.addKeyHandler(v,w),this.addKeyHandler(O,w),r.getModel().addListener(mxEvent.CHANGE,w),this.listeners.push({destroy:function(){r.getModel().removeListener(w)}}),w(),t},StyleFormatPanel.prototype.addLineJumps=function(t){var i=this.format.getSelectionState();if(Graph.lineJumpsEnabled&&0<i.edges.length&&0==i.vertices.length&&i.lineJumps){t.style.padding="8px 0px 24px 18px";for(var e=this.editorUi,n=e.editor.graph,l=document.createElement("div"),s=(l.style.position="absolute",l.style.fontWeight="bold",l.style.width="80px",mxUtils.write(l,mxResources.get("lineJumps")),t.appendChild(l),document.createElement("select")),o=(s.style.position="absolute",s.style.marginTop="-2px",s.style.right="76px",s.style.width="62px",["none","arc","gap","sharp"]),a=0;a<o.length;a++){var r=document.createElement("option");r.setAttribute("value",o[a]),mxUtils.write(r,mxResources.get(o[a])),s.appendChild(r)}mxEvent.addListener(s,"change",function(t){n.getModel().beginUpdate();try{n.setCellStyles("jumpStyle",s.value,n.getSelectionCells()),e.fireEvent(new mxEventObject("styleChanged","keys",["jumpStyle"],"values",[s.value],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}mxEvent.consume(t)}),mxEvent.addListener(s,"click",function(t){mxEvent.consume(t)}),t.appendChild(s);var d=this.addUnitInput(t,"pt",22,33,function(){u.apply(this,arguments)}),u=this.installInputHandler(d,"jumpSize",Graph.defaultJumpSize,0,999," pt"),m=mxUtils.bind(this,function(t,e,n){i=this.format.getSelectionState(),s.value=mxUtils.getValue(i.style,"jumpStyle","none"),!n&&document.activeElement==d||(n=parseInt(mxUtils.getValue(i.style,"jumpSize",Graph.defaultJumpSize)),d.value=isNaN(n)?"":n+" pt")});this.addKeyHandler(d,m),n.getModel().addListener(mxEvent.CHANGE,m),this.listeners.push({destroy:function(){n.getModel().removeListener(m)}}),m()}else t.style.display="none";return t},StyleFormatPanel.prototype.addEffects=function(t){var i,e=this.editorUi.editor.graph,n=(this.format.getSelectionState(),t.style.paddingTop="0px",t.style.paddingBottom="2px",document.createElement("table")),l=(mxClient.IS_QUIRKS&&(n.style.fontSize="1em"),n.style.width="100%",n.style.fontWeight="bold",n.style.paddingRight="20px",document.createElement("tbody")),s=document.createElement("tr"),o=(s.style.padding="0px",document.createElement("td")),a=(o.style.padding="0px",o.style.width="50%",o.setAttribute("valign","top"),o.cloneNode(!0)),r=(a.style.paddingLeft="8px",s.appendChild(o),s.appendChild(a),l.appendChild(s),n.appendChild(l),t.appendChild(n),o),d=mxUtils.bind(this,function(t,e,n){t=this.createCellOption(t,e,n);t.style.width="100%",r.appendChild(t),r=r==o?a:o,0}),u=mxUtils.bind(this,function(t,e,n){i=this.format.getSelectionState(),o.innerHTML="",a.innerHTML="",r=o,i.rounded&&d(mxResources.get("rounded"),mxConstants.STYLE_ROUNDED,0),"swimlane"==i.style.shape&&d(mxResources.get("divider"),"swimlaneLine",1),i.containsImage||d(mxResources.get("shadow"),mxConstants.STYLE_SHADOW,0),i.glass&&d(mxResources.get("glass"),mxConstants.STYLE_GLASS,0),d(mxResources.get("sketch"),"sketch",0)});return e.getModel().addListener(mxEvent.CHANGE,u),this.listeners.push({destroy:function(){e.getModel().removeListener(u)}}),u(),t},StyleFormatPanel.prototype.addStyleOps=function(t){t.style.paddingTop="10px",t.style.paddingBottom="10px";var e=mxUtils.button(mxResources.get("setAsDefaultStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("setAsDefaultStyle").funct()}));return e.setAttribute("title",mxResources.get("setAsDefaultStyle")+" ("+this.editorUi.actions.get("setAsDefaultStyle").shortcut+")"),e.style.width="202px",t.appendChild(e),t},DiagramStylePanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(DiagramStylePanel,BaseFormatPanel),DiagramStylePanel.prototype.init=function(){this.editorUi.editor.graph;this.container.appendChild(this.addView(this.createPanel()))},DiagramStylePanel.prototype.addView=function(t){var i=this.editorUi,d=i.editor.graph,u=d.getModel(),l=(t.style.whiteSpace="normal","1"==d.currentVertexStyle.sketch&&"1"==d.currentEdgeStyle.sketch),m="1"==d.currentVertexStyle.rounded,c="1"==d.currentEdgeStyle.curved,e=document.createElement("div"),n=(e.style.paddingBottom="12px",e.style.marginRight="16px",t.style.paddingTop="8px",document.createElement("table")),s=(mxClient.IS_QUIRKS&&(n.style.fontSize="1em"),n.style.width="100%",n.style.fontWeight="bold",document.createElement("tbody")),o=document.createElement("tr");o.style.padding="0px",(L=document.createElement("td")).style.padding="0px",L.style.width="50%",L.setAttribute("valign","middle");(R=L.cloneNode(!0)).style.paddingLeft="8px",o.appendChild(L),o.appendChild(R),s.appendChild(o),n.appendChild(s),L.appendChild(this.createOption(mxResources.get("sketch"),function(){return l},function(t){(l=t)?(d.currentEdgeStyle.sketch="1",d.currentVertexStyle.sketch="1"):(delete d.currentEdgeStyle.sketch,delete d.currentVertexStyle.sketch),d.updateCellStyles("sketch",t?"1":null,d.getVerticesAndEdges())},null,function(t){t.style.width="auto"})),R.appendChild(this.createOption(mxResources.get("rounded"),function(){return m},function(t){(m=t)?d.currentVertexStyle.rounded="1":delete d.currentVertexStyle.rounded,d.updateCellStyles("rounded",t?"1":null,d.getVerticesAndEdges(!0,!0))},null,function(t){t.style.width="auto"})),L=L.cloneNode(!1),R=R.cloneNode(!1),(o=o.cloneNode(!1)).appendChild(L),o.appendChild(R),s.appendChild(o),L.appendChild(this.createOption(mxResources.get("curved"),function(){return c},function(t){(c=t)?d.currentEdgeStyle.curved="1":delete d.currentEdgeStyle.curved,d.updateCellStyles("curved",t?"1":null,d.getVerticesAndEdges(!1,!0))},null,function(t){t.style.width="auto"})),e.appendChild(n),t.appendChild(e);var p=["fillColor","strokeColor","fontColor","gradientColor"],g=mxUtils.bind(this,function(t,e){var n=d.getVerticesAndEdges();u.beginUpdate();try{for(var i=0;i<n.length;i++){for(var l=d.getCellStyle(n[i]),s=(null!=l.labelBackgroundColor&&d.updateCellStyles("labelBackgroundColor",null!=e?e.background:null,[n[i]]),u.isEdge(n[i])),o=u.getStyle(n[i]),a=s?d.currentEdgeStyle:d.currentVertexStyle,r=0;r<t.length;r++)(null!=l[t[r]]&&l[t[r]]!=mxConstants.NONE||t[r]!=mxConstants.STYLE_FILLCOLOR&&t[r]!=mxConstants.STYLE_STROKECOLOR)&&(o=mxUtils.setStyle(o,t[r],a[t[r]]));u.setStyle(n[i],o)}}finally{u.endUpdate()}}),h=mxUtils.bind(this,function(t,e,n){if(null!=t)for(var i=0;i<e.length;i++)(null!=t[e[i]]&&t[e[i]]!=mxConstants.NONE||e[i]!=mxConstants.STYLE_FILLCOLOR&&e[i]!=mxConstants.STYLE_STROKECOLOR)&&(t[e[i]]=n[e[i]])}),x=mxUtils.bind(this,function(t,e,n,i,l){if(null!=t)for(var s in null!=n&&null!=e.labelBackgroundColor&&(i=null!=i?i.background:null,l=null!=l?l:d,null==(i=null==i?l.background:i)&&(i=l.defaultPageBackgroundColor),e.labelBackgroundColor=i),t)(null==n||null!=e[s]&&e[s]!=mxConstants.NONE||s!=mxConstants.STYLE_FILLCOLOR&&s!=mxConstants.STYLE_STROKECOLOR)&&(e[s]=t[s])}),s=mxUtils.button(mxResources.get("reset"),mxUtils.bind(this,function(t){var e=d.getVerticesAndEdges(!0,!0);if(0<e.length){u.beginUpdate();try{d.updateCellStyles("sketch",null,e),d.updateCellStyles("rounded",null,e),d.updateCellStyles("curved",null,d.getVerticesAndEdges(!1,!0))}finally{u.endUpdate()}}d.defaultVertexStyle=mxUtils.clone(i.initialDefaultVertexStyle),d.defaultEdgeStyle=mxUtils.clone(i.initialDefaultEdgeStyle),i.clearDefaultStyle()})),y=(s.setAttribute("title",mxResources.get("reset")),s.style.textOverflow="ellipsis",s.style.maxWidth="90px",R.appendChild(s),mxUtils.bind(this,function(l,s,o,a,t){var e=document.createElement("div"),r=(e.style.cssText="position:absolute;display:inline-block;width:100%;height:100%;overflow:hidden;pointer-events:none;",t.appendChild(e),new Graph(e,null,null,d.getStylesheet()));r.resetViewOnRootChange=!1,r.foldingEnabled=!1,r.gridEnabled=!1,r.autoScroll=!1,r.setTooltips(!1),r.setConnectable(!1),r.setPanning(!1),r.setEnabled(!1),r.getCellStyle=function(t){var e=mxUtils.clone(Graph.prototype.getCellStyle.apply(this,arguments)),n=d.stylesheet.getDefaultVertexStyle(),i=s;return u.isEdge(t)&&(n=d.stylesheet.getDefaultEdgeStyle(),i=o),h(e,p,n),x(l,e,t,a,r),x(i,e,t,a,r),e},r.model.beginUpdate();try{var n=r.insertVertex(r.getDefaultParent(),null,"Shape",14,8,70,40,"strokeWidth=2;"),i=r.insertEdge(r.getDefaultParent(),null,"Connector",n,n,"edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;endSize=5;strokeWidth=2;");i.geometry.points=[new mxPoint(32,70)],i.geometry.offset=new mxPoint(0,8)}finally{r.model.endUpdate()}})),S=document.createElement("div"),a=(S.style.position="relative",t.appendChild(S),null==this.format.cachedStyleEntries&&(this.format.cachedStyleEntries=[]),mxUtils.bind(this,function(s,o,a,r,t){var n=this.format.cachedStyleEntries[t];null==n&&((n=document.createElement("div")).style.cssText="display:inline-block;position:relative;width:96px;height:90px;cursor:pointer;border:1px solid gray;margin:2px;overflow:hidden;",null!=r&&null!=r.background&&(n.style.backgroundColor=r.background),y(s,o,a,r,n),mxEvent.addGestureListeners(n,mxUtils.bind(this,function(t){n.style.opacity=.5}),null,mxUtils.bind(this,function(t){n.style.opacity=1,d.defaultVertexStyle=mxUtils.clone(i.initialDefaultVertexStyle),d.defaultEdgeStyle=mxUtils.clone(i.initialDefaultEdgeStyle),x(s,d.defaultVertexStyle),x(s,d.defaultEdgeStyle),x(o,d.defaultVertexStyle),x(a,d.defaultEdgeStyle),i.clearDefaultStyle(),l?(d.currentEdgeStyle.sketch="1",d.currentVertexStyle.sketch="1"):(d.currentEdgeStyle.sketch="0",d.currentVertexStyle.sketch="0"),d.currentVertexStyle.rounded=m?"1":"0",d.currentEdgeStyle.rounded="1",d.currentEdgeStyle.curved=c?"1":"0",u.beginUpdate();try{g(p,r);var e=new ChangePageSetup(i,null!=r?r.background:null);e.ignoreImage=!0,u.execute(e),u.execute(new ChangeGridColor(i,null!=r&&null!=r.gridColor?r.gridColor:d.view.defaultGridColor))}finally{u.endUpdate()}})),mxEvent.addListener(n,"mouseenter",mxUtils.bind(this,function(t){var l=d.getCellStyle,e=d.background,n=d.view.gridColor;d.background=null!=r?r.background:null,d.view.gridColor=null!=r&&null!=r.gridColor?r.gridColor:d.view.defaultGridColor,d.getCellStyle=function(t){var e=mxUtils.clone(l.apply(this,arguments)),n=d.stylesheet.getDefaultVertexStyle(),i=o;return u.isEdge(t)&&(n=d.stylesheet.getDefaultEdgeStyle(),i=a),h(e,p,n),x(s,e,t,r),x(i,e,t,r),e},d.refresh(),d.getCellStyle=l,d.background=e,d.view.gridColor=n})),mxEvent.addListener(n,"mouseleave",mxUtils.bind(this,function(t){d.refresh()})),this.format.cachedStyleEntries[t]=n),S.appendChild(n)})),r=Math.ceil(Editor.styles.length/10),C=(this.format.currentStylePage=null!=this.format.currentStylePage?this.format.currentStylePage:0,[]),E=mxUtils.bind(this,function(){0<C.length&&(C[this.format.currentStylePage].style.background="#84d7ff");for(var t=10*this.format.currentStylePage;t<Math.min(10*(this.format.currentStylePage+1),Editor.styles.length);t++){var e=Editor.styles[t];a(e.commonStyle,e.vertexStyle,e.edgeStyle,e.graph,t)}}),f=mxUtils.bind(this,function(t){0<=t&&t<r&&(C[this.format.currentStylePage].style.background="transparent",S.innerHTML="",this.format.currentStylePage=t,E())});if(1<r){var T=document.createElement("div");T.style.whiteSpace="nowrap",T.style.position="relative",T.style.textAlign="center",T.style.paddingTop="4px",T.style.width="210px",t.style.paddingBottom="8px";for(var L,R,b=0;b<r;b++){var A=document.createElement("div");A.style.display="inline-block",A.style.width="6px",A.style.height="6px",A.style.marginLeft="4px",A.style.marginRight="3px",A.style.borderRadius="3px",A.style.cursor="pointer",A.style.background="transparent",A.style.border="1px solid #b5b6b7",mxUtils.bind(this,function(t,e){mxEvent.addListener(A,"click",mxUtils.bind(this,function(){f(t)}))})(b,A),T.appendChild(A),C.push(A)}function U(t){mxEvent.addListener(t,"mouseenter",function(){t.style.opacity="1"}),mxEvent.addListener(t,"mouseleave",function(){t.style.opacity="0.5"})}t.appendChild(T),E(),r<15&&((L=document.createElement("div")).style.cssText="position:absolute;left:0px;top:4px;bottom:0px;width:20px;margin:0px;opacity:0.5;background-repeat:no-repeat;background-position:center center;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQBAMAAADQT4M0AAAAIVBMVEUAAAB2dnZ4eHh3d3d1dXVxcXF2dnZ2dnZ2dnZxcXF2dnYmb3w1AAAACnRSTlMAfCTkhhvb7cQSPH2JPgAAADRJREFUCNdjwACMAmBKaiGYs2oJmLPKAZ3DabU8AMRTXpUKopislqFyVzCAuUZgikkBZjoAcMYLnp53P/UAAAAASUVORK5CYII=);",mxEvent.addListener(L,"click",mxUtils.bind(this,function(){f(mxUtils.mod(this.format.currentStylePage-1,r))})),(R=document.createElement("div")).style.cssText="position:absolute;right:2px;top:4px;bottom:0px;width:20px;margin:0px;opacity:0.5;background-repeat:no-repeat;background-position:center center;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQBAMAAADQT4M0AAAAIVBMVEUAAAB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnYBuwCcAAAACnRSTlMAfCTkhhvb7cQSPH2JPgAAADZJREFUCNdjQAOMAmBKaiGY8loF5rKswsZlrVo8AUiFrTICcbIWK8A5DF1gDoMymMPApIAwHwCS0Qx/U7qCBQAAAABJRU5ErkJggg==);",T.appendChild(L),T.appendChild(R),mxEvent.addListener(R,"click",mxUtils.bind(this,function(){f(mxUtils.mod(this.format.currentStylePage+1,r))})),U(L),U(R))}else E();return t},DiagramFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(DiagramFormatPanel,BaseFormatPanel),DiagramFormatPanel.showPageView=!0,DiagramFormatPanel.prototype.showBackgroundImageOption=!0,DiagramFormatPanel.prototype.init=function(){var t=this.editorUi.editor.graph;this.container.appendChild(this.addView(this.createPanel())),t.isEnabled()&&(this.container.appendChild(this.addOptions(this.createPanel())),this.container.appendChild(this.addPaperSize(this.createPanel())),this.container.appendChild(this.addStyleOps(this.createPanel())))},DiagramFormatPanel.prototype.addView=function(t){var e,n,i=this.editorUi,l=i.editor.graph;return t.appendChild(this.createTitle(mxResources.get("view"))),this.addGridOption(t),DiagramFormatPanel.showPageView&&t.appendChild(this.createOption(mxResources.get("pageView"),function(){return l.pageVisible},function(t){i.actions.get("pageView").funct()},{install:function(t){this.listener=function(){t(l.pageVisible)},i.addListener("pageViewChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}})),l.isEnabled()&&(e=this.createColorOption(mxResources.get("background"),function(){return l.background},function(t){t=new ChangePageSetup(i,t);t.ignoreImage=!0,l.model.execute(t)},"#ffffff",{install:function(t){this.listener=function(){t(l.background)},i.addListener("backgroundColorChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}}),this.showBackgroundImageOption&&((n=mxUtils.button(mxResources.get("image"),function(t){i.showBackgroundImageDialog(null,i.editor.graph.backgroundImage),mxEvent.consume(t)})).style.position="absolute",n.className="geColorBtn",n.style.marginTop="-4px",n.style.paddingBottom=11==document.documentMode||mxClient.IS_MT?"0px":"2px",n.style.height="22px",n.style.right=mxClient.IS_QUIRKS?"52px":"72px",n.style.width="56px",e.appendChild(n)),t.appendChild(e)),t},DiagramFormatPanel.prototype.addOptions=function(t){var e=this.editorUi,n=e.editor.graph;return t.appendChild(this.createTitle(mxResources.get("options"))),n.isEnabled()&&(t.appendChild(this.createOption(mxResources.get("connectionArrows"),function(){return n.connectionArrowsEnabled},function(t){e.actions.get("connectionArrows").funct()},{install:function(t){this.listener=function(){t(n.connectionArrowsEnabled)},e.addListener("connectionArrowsChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}})),t.appendChild(this.createOption(mxResources.get("connectionPoints"),function(){return n.connectionHandler.isEnabled()},function(t){e.actions.get("connectionPoints").funct()},{install:function(t){this.listener=function(){t(n.connectionHandler.isEnabled())},e.addListener("connectionPointsChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}})),t.appendChild(this.createOption(mxResources.get("guides"),function(){return n.graphHandler.guidesEnabled},function(t){e.actions.get("guides").funct()},{install:function(t){this.listener=function(){t(n.graphHandler.guidesEnabled)},e.addListener("guidesEnabledChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}}))),t},DiagramFormatPanel.prototype.addGridOption=function(t){var n=this,i=this.editorUi,l=i.editor.graph,s=document.createElement("input"),o=(s.style.position="absolute",s.style.textAlign="right",s.style.width="38px",s.value=this.inUnit(l.getGridSize())+" "+this.getUnit(),this.createStepper(s,e,this.getUnitStep(),null,null,null,this.isFloatUnit()));function e(t){var e=(n.isFloatUnit()?parseFloat:parseInt)(s.value);(e=n.fromUnit(Math.max(n.inUnit(1),isNaN(e)?n.inUnit(10):e)))!=l.getGridSize()&&l.setGridSize(e),s.value=n.inUnit(e)+" "+n.getUnit(),mxEvent.consume(t)}s.style.display=l.isGridEnabled()?"":"none",o.style.display=s.style.display,mxEvent.addListener(s,"keydown",function(t){13==t.keyCode?(l.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(s.value=l.getGridSize(),l.container.focus(),mxEvent.consume(t))}),mxEvent.addListener(s,"blur",e),mxEvent.addListener(s,"change",e);function a(t,e){s.value=n.inUnit(l.getGridSize())+" "+n.getUnit(),n.format.refresh()}var r;l.view.addListener("unitChanged",a),this.listeners.push({destroy:function(){l.view.removeListener(a)}}),mxClient.IS_SVG?(s.style.marginTop="-2px",s.style.right="84px",o.style.marginTop="-16px",o.style.right="72px",(r=this.createColorOption(mxResources.get("grid"),function(){var t=l.view.gridColor;return l.isGridEnabled()?t:null},function(t){var e=l.isGridEnabled();t==mxConstants.NONE?l.setGridEnabled(!1):(l.setGridEnabled(!0),i.setGridColor(t)),s.style.display=l.isGridEnabled()?"":"none",o.style.display=s.style.display,e!=l.isGridEnabled()&&i.fireEvent(new mxEventObject("gridEnabledChanged"))},"#e0e0e0",{install:function(t){this.listener=function(){t(l.isGridEnabled()?l.view.gridColor:null)},i.addListener("gridColorChanged",this.listener),i.addListener("gridEnabledChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}})).appendChild(s),r.appendChild(o),t.appendChild(r)):(s.style.marginTop="2px",s.style.right="32px",o.style.marginTop="2px",o.style.right="20px",t.appendChild(s),t.appendChild(o),t.appendChild(this.createOption(mxResources.get("grid"),function(){return l.isGridEnabled()},function(t){l.setGridEnabled(t),l.isGridEnabled()&&(l.view.gridColor="#e0e0e0"),i.fireEvent(new mxEventObject("gridEnabledChanged"))},{install:function(t){this.listener=function(){s.style.display=l.isGridEnabled()?"":"none",o.style.display=s.style.display,t(l.isGridEnabled())},i.addListener("gridEnabledChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}})))},DiagramFormatPanel.prototype.addDocumentProperties=function(t){this.editorUi.editor.graph;return t.appendChild(this.createTitle(mxResources.get("options"))),t},DiagramFormatPanel.prototype.addPaperSize=function(t){function e(){l.set(i.pageFormat)}var n=this.editorUi,i=n.editor.graph,l=(t.appendChild(this.createTitle(mxResources.get("paperSize"))),PageSetupDialog.addPageFormatPanel(t,"formatpanel",i.pageFormat,function(t){null!=i.pageFormat&&i.pageFormat.width==t.width&&i.pageFormat.height==t.height||((t=new ChangePageSetup(n,null,null,t)).ignoreColor=!0,t.ignoreImage=!0,i.model.execute(t))}));this.addKeyHandler(l.widthInput,function(){l.set(i.pageFormat)}),this.addKeyHandler(l.heightInput,function(){l.set(i.pageFormat)});return n.addListener("pageFormatChanged",e),this.listeners.push({destroy:function(){n.removeListener(e)}}),i.getModel().addListener(mxEvent.CHANGE,e),this.listeners.push({destroy:function(){i.getModel().removeListener(e)}}),t},DiagramFormatPanel.prototype.addStyleOps=function(t){var e=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editData").funct()}));return e.setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),e.style.width="202px",e.style.marginBottom="2px",t.appendChild(e),mxUtils.br(t),(e=mxUtils.button(mxResources.get("clearDefaultStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("clearDefaultStyle").funct()}))).setAttribute("title",mxResources.get("clearDefaultStyle")+" ("+this.editorUi.actions.get("clearDefaultStyle").shortcut+")"),e.style.width="202px",t.appendChild(e),t},DiagramFormatPanel.prototype.destroy=function(){BaseFormatPanel.prototype.destroy.apply(this,arguments),this.gridEnabledListener&&(this.editorUi.removeListener(this.gridEnabledListener),this.gridEnabledListener=null)};